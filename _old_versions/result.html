<!doctype html>
<html lang="zh-TW">
<head>
  <meta charset="utf-8" />
  <meta name="robots" content="noindex, nofollow">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>çµæœ</title>
  <link rel="stylesheet" href="assets/app.css" />

  <style>
    /* âœ… è®“çµæœé å¯ä»¥æ»¾å‹•ï¼ˆé¿å… app.css overflow:hidden é€ æˆçœ‹ä¸åˆ°ä¸‹é¢ï¼‰ */
    html, body { height: 100%; overflow: auto; }

    /* âœ… é€™é å°ˆç”¨å¾®èª¿ï¼ˆä¸ç ´å£ app.cssï¼‰ */
    .stage{ align-items:flex-start; }

    .grid{
      display:grid;
      grid-template-columns: 1.15fr .85fr;
      gap:12px;
    }
    @media (max-width: 900px){
      .grid{grid-template-columns: 1fr;}
    }

    .panel{
      padding:14px;
      border-radius:16px;
      background: rgba(255,255,255,.62);
      border: 1px solid rgba(0,0,0,.08);
      box-shadow: 0 18px 60px rgba(0,0,0,.10);
      color: rgba(24,11,10,.92);
    }

    .panel .h{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-bottom:10px;
    }

    .panel .h strong{
      font-size:13px;
      letter-spacing:.8px;
    }

    .chip{
      padding:6px 10px;
      border-radius:999px;
      font-size:12px;
      border:1px solid rgba(0,0,0,.10);
      background: rgba(255,255,255,.7);
      white-space:nowrap;
    }

    .score{
      display:flex;
      align-items:flex-end;
      gap:12px;
    }
    .score .num{
      font-size:46px;
      font-weight:900;
      letter-spacing:1px;
      line-height:1;
      background: linear-gradient(135deg, rgba(255,157,184,.95), rgba(216,189,91,.95));
      -webkit-background-clip:text;
      background-clip:text;
      color:transparent;
    }
    .score .meta{
      font-size:12px;
      color: rgba(24,11,10,.70);
      line-height:1.5;
    }

    .canvasWrap{
      border-radius:16px;
      overflow:hidden;
      border:1px solid rgba(0,0,0,.10);
      background: rgba(255,255,255,.55);
    }
    canvas{display:block; width:100%; height:auto;}

    .list{display:flex; flex-direction:column; gap:8px; margin-top:10px;}
    .item{
      padding:10px 12px;
      border-radius:14px;
      background: rgba(255,255,255,.70);
      border: 1px solid rgba(0,0,0,.08);
      color: rgba(24,11,10,.90);
      font-size:13px;
      line-height:1.5;
    }
    .badge{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding:6px 10px;
      border-radius:999px;
      font-size:12px;
      border:1px solid rgba(0,0,0,.10);
      background: rgba(255,255,255,.85);
      margin-right:8px;
      white-space:nowrap;
    }
    .mutedText{color: rgba(24,11,10,.68); font-size:12px; line-height:1.5;}

    /* âœ… Bar Chart è¡Œ */
    .barRow{
      display:flex; align-items:center; gap:12px;
      padding:10px 12px;
      border-radius:14px;
      background: rgba(255,255,255,.62);
      border: 1px solid rgba(0,0,0,.08);
    }
    .barLabel{ width:110px; font-size:12px; color: rgba(24,11,10,.74); }
    .barTrack{
      flex:1;
      height:12px;
      border-radius:999px;
      background: rgba(0,0,0,.10);
      overflow:hidden;
    }
    .barFill{
      height:100%;
      width:0%;
      border-radius:999px;
      background: linear-gradient(135deg, rgba(242,216,140,.95), rgba(255,157,184,.85));
    }
    .barVal{ width:42px; text-align:right; font-weight:900; font-size:12px; }

    #radarA{
    width: 450px;     /* ğŸ‘‰ æƒ³å¤šå°å°±æ”¹é€™è£¡ */
    height: auto;
    display: block;
    margin: 0 auto;
    } 

    #radarB{
    width: 450px;     /* ğŸ‘‰ æƒ³å¤šå°å°±æ”¹é€™è£¡ */
    height: auto;
    display: block;
    margin: 0 auto;
    } 



    /* å•†å“æ¨è–¦ */
    .productTitle{font-weight:900; margin-bottom:4px;}
    .productMeta{display:flex; gap:8px; align-items:center; margin-top:6px; font-size:12px; color: rgba(24,11,10,.68);}

    /* âœ… æ¯å¼µå¡ç‰‡å›ºå®šå¯¬ï¼Œæ©«å‘æ»‘æ›´åƒå•†å“åˆ— */
    .productCard{
      display:flex;
      flex-direction:column;
      overflow:hidden;
      min-width: 220px;
      flex: 0 0 220px;
      scroll-snap-align: start;
    }
    .productImg{
      width:100%;
      height:140px;
      object-fit:cover;
      border-radius:10px;
      border:1px solid rgba(0,0,0,.08);
      background:#f3f3f3;
    }
    .productBody{padding-top:8px;}
    .productCta{
      margin-left:auto;
      padding:4px 10px;
      border-radius:999px;
      border:1px solid rgba(0,0,0,.12);
      background: rgba(255,255,255,.75);
      font-size:12px;
      cursor:pointer;
      text-decoration:none;
      color: rgba(24,11,10,.86);
    }

    .step{display:none; opacity:0; transition: opacity .35s ease;}
    .step.visible{display:block; opacity:1;}

    .detailLink{
      margin-top:10px;
      background:none;
      border:none;
      color: rgba(24,11,10,.78);
      font-size:12px;
      cursor:pointer;
      text-decoration: underline;
      padding:0;
      transition: transform .15s ease;
    }
    .detailLink:hover{transform: translateX(2px);}

    .demoBox{
      height:80px;
      border-radius:12px;
      background:#f7f7f7;
      border:1px dashed rgba(0,0,0,.12);
      line-height:80px;
      text-align:center;
      color:#aaa;
      font-size:12px;
    }

    .detailActions{display:flex; gap:10px; justify-content:center; margin-top:16px; flex-wrap:wrap;}
    .abnormalItem{
      border:1px solid rgba(0,0,0,.08);
      border-radius:14px;
      padding:10px 12px;
      background: rgba(255,255,255,.70);
      margin-top:10px;
    }
    .largeItem{
      padding:16px;
      font-size:14px;
      line-height:1.7;
    }

    /* âœ… æ©«å‘å•†å“åˆ—ï¼ˆè¦†è“‹ .list çš„ columnï¼‰ */
    #productList{
      display:flex;
      flex-direction:row;
      gap:10px;
      overflow-x:auto;
      overflow-y:hidden;
      padding-bottom:6px;
      scroll-snap-type: x mandatory;
      -webkit-overflow-scrolling: touch;
      margin-top:10px;
    }
    #productListDetail{
      display:flex;
      flex-direction:row;
      gap:10px;
      overflow-x:auto;
      overflow-y:hidden;
      padding-bottom:6px;
      scroll-snap-type: x mandatory;
      -webkit-overflow-scrolling: touch;
      margin-top:10px;
    }
     
    #productSentinelDetail{
      flex: 0 0 160px;
      display:flex;
      align-items:center;
      justify-content:center;
      border-radius:14px;
      background: rgba(255,255,255,.45);
      border: 1px dashed rgba(0,0,0,.14);
      color: rgba(24,11,10,.65);
      font-size: 12px;
      user-select:none;
      min-height: 210px;
    }


    /* âœ… å³é‚Š sentinelï¼ˆç„¡é™è¼‰å…¥è§¸ç™¼é»ï¼‰ */
    #productSentinelX{
      flex: 0 0 160px;
      display:flex;
      align-items:center;
      justify-content:center;
      border-radius:14px;
      background: rgba(255,255,255,.45);
      border: 1px dashed rgba(0,0,0,.14);
      color: rgba(24,11,10,.65);
      font-size: 12px;
      user-select:none;
      min-height: 210px;
    }

    /* âœ… å¡ç‰‡æ·¡å…¥å‹•ç•« */
    @keyframes cardFadeIn {
      from { opacity: 0; transform: translateY(8px); }
      to   { opacity: 1; transform: translateY(0); }
    }
    .fade-in{ animation: cardFadeIn .35s ease both; }

    /* âœ… ç¾åŒ–æ©«å‘æ»¾å‹•æ¢ */
    #productList::-webkit-scrollbar{ height: 10px; }
    #productList::-webkit-scrollbar-thumb{ background: rgba(0,0,0,.12); border-radius: 999px; }
    #productList::-webkit-scrollbar-track{ background: transparent; }
    #productListDetail::-webkit-scrollbar{ height: 10px; }
    #productListDetail::-webkit-scrollbar-thumb{ background: rgba(0,0,0,.12); border-radius: 999px; }
    #productListDetail::-webkit-scrollbar-track{ background: transparent; }
  </style>
</head>

<body>
  <div class="bg-glass"></div>

  <header>
    <div class="brand">
      <div class="logo"></div>
      <div>
        <h1>çµæœ</h1>
        <p>äº”è§’åˆ†æ Ã— æ°£è‰² Ã— è†šæ³ Ã— å»ºè­°</p>
      </div>
    </div>
    <div style="display:flex; gap:8px;">
      <button class="btn" onclick="location.href='analyze.html'">å†åˆ†æ</button>
      <button class="btn" onclick="location.href='index.html'">å›é¦–é </button>
    </div>
  </header>

  <div class="stage">
    <div class="card">
      <div class="card-head">
        <div>
          <div class="title">AI åˆ†æå ±å‘Š</div>
          <div class="sub">è³‡æ–™ä¾†æºï¼šlocalStorageï¼ˆæ²’è³‡æ–™æœƒè‡ªå‹•ç”¨æ¸¬è©¦æ•¸å€¼ï¼‰</div>
        </div>
        
      </div>

      <div class="body">

        <!-- âœ… STEP 3ï¼šç¸½è¦½ -->
        <div id="step-3" class="step visible">

          <div class="grid" id="radarSection">
            <!-- å·¦ï¼šç¸½åˆ† + é›·é” -->
            <div class="panel" id="summarySection">
              <div class="h">
                <strong>ç¸½è¦½ï¼ˆOverallï¼‰</strong>
                <span class="chip" id="qualityChip">--</span>
              </div>

              <div class="score">
                <div class="num" id="overallNum">--</div>
                <div class="meta" id="overallMeta">
                  æœƒæ ¹æ“šäº”è§’æŒ‡æ¨™ + æ°£è‰² + è†šæ³æ¨ä¼°<br />
                  å»ºè­°æ‹æ”ï¼šè‡ªç„¶å…‰ã€é¿å…èƒŒå…‰ã€è·é›¢ 30â€“40cm
                </div>
              </div>

              <div style="height:12px;"></div>

              <div class="h">
                <strong>äº”è§’é›·é”ï¼ˆäº”é …æ ¸å¿ƒï¼‰</strong>
                <span class="chip">0â€“100</span>
              </div>

              <div class="canvasWrap">
                <canvas id="radar" width="520" height="360"></canvas>
              </div>

              <div class="mutedText" style="margin-top:10px;">
                äº”è§’å»ºè­°ï¼šäº”å€‹æŒ‡æ¨™è¶Šå¹³å‡è¶Šå¥½ï¼›å–®é …éä½ä»£è¡¨é‚£é …éœ€è¦å„ªå…ˆæ”¹å–„ã€‚
              </div>

              <!-- âœ… é€™é¡†æŒ‰éˆ•ï¼šç›®å‰è¨­è¨ˆæˆå°åˆ° Step A -->
              <button class="detailLink" onclick="switchStep('step-3','step-a-detail')">äº”è§’é›·é”åˆ†æ è©³æƒ… â†’</button>
            </div>

            <!-- å³ï¼šæ°£è‰²/è†šæ³æ‘˜è¦ -->
            <div class="panel">
              <div class="h">
                <strong>å°ˆæ¥­æ‘˜è¦</strong>
                <span class="chip" id="timestampChip">--</span>
              </div>

              <div class="list" id="summaryCards"></div>

              <div style="height:30px;"></div>
              <div class="h">
                <strong>é¢¨éšªæé†’</strong>
                <span class="chip">å»ºè­°åƒè€ƒ</span>
              </div>

              <div class="list" id="riskList"></div>

              <!-- âœ… å°åˆ° Step B -->
              <button class="detailLink" onclick="switchStep('step-3','step-b-detail')">å°ˆæ¥­ èˆ‡ é¢¨éšª æ‘˜è¦å»ºè­° â†’</button>
            </div>
          </div>

          <div style="height:12px;"></div>

          <!-- æ¢ç‹€åœ– -->
          <div class="kpi" style="margin-top:12px;">
            <div style="display:flex; align-items:center; justify-content:space-between;">
              <div class="sub">æŒ‡æ¨™æ˜ç´°ï¼ˆBar Chartï¼‰</div>
              <span class="tag">è¶Šé«˜è¶Šå¥½</span>
            </div>
            <div id="bars" style="margin-top:10px; display:flex; flex-direction:column; gap:10px;"></div>
          </div>

          <div style="height:12px;"></div>

          <!-- å»ºè­° -->
          <div class="panel" id="tipsSection">
            <div class="h">
              <strong>æ”¹å–„å»ºè­°ï¼ˆTipsï¼‰</strong>
              <span class="chip" id="tipsCount">0</span>
            </div>
            <div class="list" id="tipsList"></div>

            <!-- âœ… å°åˆ° Step Cï¼ˆè©³ç´°ç‰ˆ Tipsï¼‰ -->
            <button class="detailLink" onclick="switchStep('step-3','step-c-detail')">æ”¹å–„å»ºè­° â†’</button>
          </div>

          <div style="height:12px;"></div>

          <!-- å•†å“æ¨è–¦ -->
        <div class="panel" id="productSection">
          <div class="h">
            <strong>å•†å“æ¨è–¦</strong>
            <span class="chip" id="productCount">0</span>
          </div>
          <div class="list" id="productList"></div>
          <button class="detailLink" onclick="switchStep('step-3','step-e-detail')">å‰å¾€å•†å“æ¨è–¦ â†’</button>
        </div>
        </div>

        <!-- âœ… STEP Aï¼šæ°£è‰²æ€¥æ•‘ç«™ï¼ˆåŒæ­¥åˆ†æ•¸ + é¡¯ç¤ºç…§ç‰‡ï¼‰ -->
        <div id="step-a-detail" class="step">
          <div class="panel">
            <div class="h">
              <strong>æ°£è‰²æ€¥æ•‘ç«™</strong>
              <span class="chip">åŒæ­¥é¡¯ç¤º</span>
            </div>

            <!-- âœ… A-Photoï¼šä½¿ç”¨è€…ç…§ç‰‡ï¼ˆæœ‰ç…§ç‰‡æ‰é¡¯ç¤ºï¼‰ -->
            <div class="item" id="aPhotoBlock" style="display:none;">
              <div style="font-weight:900; margin-bottom:8px;">æœ¬æ¬¡æ‹æ”ç…§ç‰‡</div>
              <img id="aUserPhoto" alt="user photo"
                   style="width:100%; max-height:320px; object-fit:cover; border-radius:14px; border:1px solid rgba(0,0,0,.10);" />
              <div class="mutedText" style="margin-top:8px;">
                ä¾†æºï¼špayload.photo æˆ– localStorage(user_photo)
              </div>
            </div>

            <div class="canvasWrap" style="margin-top:12px;">
              <canvas id="radarA" width="520" height="360"></canvas>
            </div>

            <div style="text-align:center; margin-top:10px;">
              <div style="font-size:12px; color: rgba(24,11,10,.65);">ç¸½åˆ†ï¼ˆOverallï¼‰</div>
              <div style="font-size:34px; font-weight:900;" id="aOverallNum">--</div>
            </div>
            
            

            <!-- âœ… A-Scoreï¼šåœˆåœˆé¡¯ç¤º 0~10 -->
            <!-- <div class="item" style="text-align:center;">
              <div style="width:110px; height:110px; background:#fdf2f2; border-radius:50%; display:inline-block; border:2px solid rgba(255,157,184,.55); padding-top:34px; box-sizing:border-box;">
                <b style="font-size:16px;"><span id="aScore">--</span> / 10</b><br>
                <small id="aStatusText">--</small>
              </div>
              <div id="aHintText" style="margin-top:12px; font-weight:700; color:#d84315;">
                --
              </div>
            </div> -->

            <!-- <div class="aRadarCircle">
              <canvas id="aRadarMini" width="120" height="120"></canvas> -->

            <!-- âœ… æ–‡å­—ç–Šåœ¨é›·é”åœ–ä¸Šï¼ˆæƒ³ä¸è¦æ–‡å­—å°±æ•´æ®µåˆªæ‰ï¼‰ -->
            <!-- <div class="aRadarOverlay">
              <b style="font-size:14px;"><span id="aScore">--</span> / 10</b><br>
              <small id="aStatusText">--</small>
              </div>
            </div>
            <div id="aHintText" style="margin-top:12px; font-weight:700; color:#d84315;">--</div> -->

            <div class="item">
              <div><b>Step 1ï¼šè‡‰éƒ¨æŒ‰æ‘© (2åˆ†é˜)</b></div>
              <div class="demoBox">ç¤ºæ„æ•™å­¸å‹•ç•«å€ï¼ˆå¯æ›æˆ GIF / MP4ï¼‰</div>
            </div>

            <div class="item">
              <div><b>Step 2ï¼šç©´ä½æŒ‰å£“ (1åˆ†é˜)</b></div>
              <div class="demoBox">ç¤ºæ„æ•™å­¸å‹•ç•«å€ï¼ˆå¯æ›æˆ GIF / MP4ï¼‰</div>
            </div>

            <div class="detailActions">
              <button class="btn" onclick="switchStep('step-a-detail','step-3')">è¿”å›å ±å‘Šç¸½è¦½</button>
              <button class="btn" onclick="switchStep('step-a-detail','step-b-detail')">å‰å¾€æ”¹å–„å»ºè­°</button>
            </div>
          </div>
        </div>

        <!-- âœ… STEP Bï¼šæ·±åº¦å•é¡Œåµæ¸¬ -->
        <div id="step-b-detail" class="step">
          <div class="panel">
            <div class="h">
              <strong>æ·±åº¦å•é¡Œåµæ¸¬</strong>
              <!-- <span class="chip">ç¤ºæ„</span> -->
            </div>

            <div class="item">
              <div style="font-weight:900; margin-bottom:8px;">ç…§ç‰‡é è¦½</div>
              <div class="demoBox" style="height:200px;">ç…§ç‰‡é¡¯ç¤ºå€ï¼ˆä¹‹å¾Œæ”¾å¾Œç«¯åœ–ç‰‡ï¼‰</div>
            </div>

            <div class="canvasWrap" style="margin-top:12px;">
              <canvas id="radarB" width="520" height="360"></canvas>
            </div>            

            <!-- <div class="item">
              <div class="canvasWrap">
                <canvas id="detailRadar" width="520" height="360"></canvas>
              </div> -->

              <div class="abnormalItem">
                <div><b>ç•°å¸¸ç›®æ¨™ Aï¼šç™¼ç‚ç—˜ç—˜</b></div>
                <div class="mutedText">åš´é‡æŒ‡æ•¸ï¼š6.8 (High) / T å­—éƒ¨ä½</div>
              </div>

              <div class="abnormalItem">
                <div><b>ç•°å¸¸ç›®æ¨™ Bï¼šå‹•æ…‹ç´°ç´‹</b></div>
                <div class="mutedText">åš´é‡æŒ‡æ•¸ï¼š6.0 (Med) / çœ¼å°¾é­šå°¾ç´‹</div>
              </div>

              <div class="abnormalItem">
                <div><b>ç•°å¸¸ç›®æ¨™ Cï¼šæ¯›å­”ç²—å¤§</b></div>
                <div class="mutedText">åš´é‡æŒ‡æ•¸ï¼š5.6 (Med) / é¼»ç¿¼å…©å´</div>
              </div>

              <div class="abnormalItem">
                <div><b>ç•°å¸¸ç›®æ¨™ Dï¼šæš—æ²‰</b></div>
                <div class="mutedText">åš´é‡æŒ‡æ•¸ï¼š5.2 (Med) / é¡é ­èˆ‡å…©é °</div>
              </div>

              <div class="abnormalItem">
                <div><b>ç•°å¸¸ç›®æ¨™ Eï¼šæ³›ç´…</b></div>
                <div class="mutedText">åš´é‡æŒ‡æ•¸ï¼š4.8 (Low) / å…©é °å€åŸŸ</div>
              </div>
            </div>

            <div class="detailActions">
              <!-- âœ… ä¿®æ­£ outIdï¼šå¾ B å» C -->
               <button class="btn" onclick="switchStep('step-b-detail','step-3')">è¿”å›å ±å‘Šç¸½è¦½</button>
              <button class="btn" onclick="switchStep('step-b-detail','step-c-detail')">å‰å¾€æ”¹å–„å»ºè­°</button>
              <!-- <button class="btn" onclick="location.href='index.html'">å›é¦–é </button> -->
            </div>
          </div>
        </div>

        <!-- STEP C?ç”Ÿæ´»æ”¹å–„å»ºè­° -->
        <div id="step-c-detail" class="step">
          <div class="panel">
            <div class="h">
              <strong>ç”Ÿæ´»æ”¹å–„å»ºè­°</strong>
              <span class="chip">å°ç§˜è¨£</span>
            </div>

            <div class="item largeItem">
              <div><b>ç‚ºä»€éº¼æœ€è¿‘æ°£è‰²è¼ƒå·®ï¼Ÿ</b></div>
              <div class="mutedText">ç–²å‹æŒçºŒç´¯ç©æ™‚ï¼Œæ–°é™³ä»£è¬èˆ‡ä¿®å¾©é€Ÿåº¦æœƒæ”¾æ…¢ã€‚èº«é«”åœ¨æé†’æ‚¨éœ€è¦æ›´å¤šæ”¯æŒã€‚</div>
            </div>

            <div class="item largeItem">
              <div><b>é£²é£Ÿè£œå……å»ºè­°</b></div>
              <div class="mutedText">æ·±ç¶ è‰²è”¬èœã€Omega-3 é£Ÿç‰©ã€ç¶­ç”Ÿç´  C æ°´æœã€å …æœèˆ‡å…¨ç©€é¡ã€‚</div>
            </div>

            <div class="item largeItem">
              <div><b>ä½œæ¯èª¿æ•´</b></div>
              <div class="mutedText">å»ºè­°å›ºå®šå°±å¯¢æ™‚é–“ï¼Œé€£çºŒ 7 å¤©è§€å¯Ÿæ°£è‰²è®ŠåŒ–ã€‚</div>
            </div>

            <div class="detailActions">
              <button class="btn" onclick="switchStep('step-c-detail','step-3')">è¿”å›å ±å‘Šç¸½è¦½</button>
              <button class="btn" onclick="switchStep('step-c-detail','step-e-detail')">å‰å¾€å•†å“æ¨è–¦</button>             
              <!-- <button class="btn" onclick="location.href='index.html'">å›é¦–é </button> -->
            </div>
          </div>
        </div>

        <!-- âœ… STEP Dï¼šæ™ºæ…§é¸å“è©³æƒ…ï¼ˆç¤ºæ„ï¼‰ -->
        <div id="step-d-detail" class="step">
          <div class="panel">
            <div class="h">
              <strong>æ™ºæ…§é¸å“è©³æƒ…</strong>
              <span class="chip">ç¤ºæ„</span>
            </div>

            <div class="item">
              <div><b>æ¨è–¦ç”¢å“</b></div>
              <div class="mutedText">é‡å°ä½ çš„å¼±é …æŒ‡æ¨™ï¼Œæ¨è–¦ä¿æ¿•ï¼ä¿®è­·ï¼é˜²æ›¬ç­‰æ–¹å‘ã€‚</div>
            </div>

            <div class="detailActions">
              <button class="btn" onclick="switchStep('step-d-detail','step-3')">è¿”å›å ±å‘Šç¸½è¦½</button>
              <!-- <button class="btn" onclick="location.href='index.html'">å›é¦–é </button> -->
            </div>
          </div>
        </div>

        <!-- âœ… STEP Eï¼šå•†å“æ¨è–¦ï¼ˆå…§é ï¼‰ -->
        <div id="step-e-detail" class="step">
          <div class="panel">
            <div class="h">
              <strong>å•†å“æ¨è–¦</strong>
              <span class="chip" id="productCount2">0</span>
            </div>

            <div class="list" id="productListDetail"></div>

            <div class="item">
              <div><b>æ™ºæ…§é¸å•†å“</b></div>
              <div class="mutedText">ä¾ä½ çš„å¼±é …æŒ‡æ¨™è‡ªå‹•æŒ‘é¸æ¨è–¦æ¸…å–®ï¼Œå¾ŒçºŒå¯æ¥å¾Œç«¯æ’åºèˆ‡å€‹äººåŒ–ã€‚</div>
            </div>

            <div class="detailActions">
              <button class="btn" onclick="switchStep('step-e-detail','step-3')">è¿”å›å ±å‘Šç¸½è¦½</button>
              <!-- <button class="btn" onclick="location.href='index.html'">å›é¦–é </button> -->
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <script>
    // =========================================================
    // âœ… 0) å°å·¥å…·ï¼šToastï¼ˆç•«é¢å³ä¸‹è§’æç¤ºï¼‰
    // =========================================================
    const toastEl = document.getElementById("toast");
    function toast(msg){
      if(!toastEl) return;
      toastEl.textContent = msg;
      toastEl.classList.add("show");
      setTimeout(()=> toastEl.classList.remove("show"), 1800);
    }

    // =========================================================
    // âœ… 1) è®€ localStorageï¼ˆæ‰¾ä¸åˆ°å°±ç”¨ demoï¼‰
    // =========================================================
    function loadResult(){
      const keys = ["result", "ai_result", "analysis_result", "payload"];
      for(const k of keys){
        const raw = localStorage.getItem(k);
        if(!raw) continue;
        try { return JSON.parse(raw); } catch(e){}
      }
      return null;
    }

    function getDemoPayload(){
      return {
        timestamp: new Date().toISOString(),
        overall: 78,
        metrics: {
          glow: 72,
          complexion: 80,
          blemish: 64,
          oilBalance: 70,
          evenness: 75
        },
        tips: [
          "å»ºè­°åœ¨è‡ªç„¶å…‰ä¸‹æ‹æ”ï¼Œé¿å…èƒŒå…‰é€ æˆæ°£è‰²åä½ã€‚",
          "å…ˆæŠŠä¿é¤Šåšç©©ï¼šä¿æ¿•ï¼‹é˜²æ›¬ï¼Œé€£çºŒ 7 å¤©å†çœ‹è¶¨å‹¢ã€‚",
          "è‹¥åæ²¹ï¼šæ¸›å°‘åšé‡ä¹³éœœï¼›è‹¥åä¹¾ï¼šå¢åŠ ä¿æ¿•å±¤ä¸¦é™ä½å»è§’è³ªé »ç‡ã€‚",
          "å›ºå®šåŒä¸€æ™‚é–“ã€åŒä¸€å…‰ç·šæ‹ 3 å¤©ï¼Œçµæœæ›´å¯ä¿¡ã€‚"
        ],
        products: []
      };
    }

    const url = new URL(location.href);
    const forceDemo = url.searchParams.get("demo") === "1";

    let payload = forceDemo ? null : loadResult();
    if(!payload){
      payload = getDemoPayload();
      toast("å·²è¼‰å…¥æ¸¬è©¦æ•¸å€¼ï¼ˆdemoï¼‰");
    }

    // =========================================================
    // âœ… 2) æ­£è¦åŒ– metricsï¼ˆæ”¯æ´ä¸­æ–‡/è‹±æ–‡æ¬„ä½ + é˜² NaNï¼‰
    // =========================================================
    const m = payload.metrics || {};

    // âœ… å·¥å…·ï¼šæŠŠä»»ä½•å€¼å®‰å…¨è½‰æˆæ•¸å­—ï¼ˆé¿å… NaNï¼‰
    const toNum = (v, fallback = 0) => {
      const n = Number(v);
      return Number.isFinite(n) ? n : fallback;
    };

    const metrics = {
      glow:       toNum(m.glow ?? m.å…‰æ¾¤, 72),
      complexion: toNum(m.complexion ?? m.æ°£è‰², 78),
      blemish:    toNum(m.blemish ?? m.ç‘•ç–µ, 64),
      oilBalance: toNum(m.oilBalance ?? m.æ²¹æ°´å¹³è¡¡, 70),
      evenness:   toNum(m.evenness ?? m.å‡å‹»åº¦, 75),
    };

    // âœ… overallï¼šå¦‚æœ payload.overall æ²’çµ¦ï¼Œå°±ç”¨äº”é …å¹³å‡
    const overall = toNum(payload.overall, Math.round(
      (metrics.glow + metrics.complexion + metrics.blemish + metrics.oilBalance + metrics.evenness) / 5
    ));

    // âœ… qualityï¼šç¸½é«”ç‹€æ…‹æ–‡å­—ï¼ˆä½ å¯èª¿æ•´é–€æª»ï¼‰
    const quality =
      overall >= 85 ? "ç‹€æ…‹æ¥µä½³" :
      overall >= 75 ? "æ•´é«”è‰¯å¥½" :
      overall >= 60 ? "å¯å†æå‡" : "éœ€è¦åŠ å¼·";

    // =========================================================
    // âœ… 3) Step Aï¼šåŒæ­¥åˆ†æ•¸ + é¡¯ç¤ºä½¿ç”¨è€…ç…§ç‰‡
    // =========================================================

    // âœ… 0~100 => 0~10ï¼ˆä¿ç•™ 1 ä½å°æ•¸ï¼‰
    // æƒ³é¡¯ç¤ºæ•´æ•¸ï¼šreturn Math.round(score100 / 10);
    function toScore10(score100){
      const n = Number(score100);
      if(!Number.isFinite(n)) return 0;
      return Math.round((n / 10) * 10) / 10;
    }

    function setStepAFromMetrics(){
      // âœ… ä½ è¦è®“ Step A é¡¯ç¤ºåˆ¥çš„æŒ‡æ¨™å°±æ”¹é€™è¡Œï¼š
      // metrics.complexion / metrics.glow / metrics.evenness ...
      const score10 = toScore10(metrics.complexion);

      const aScore = document.getElementById("aScore");
      const aStatusText = document.getElementById("aStatusText");
      const aHintText = document.getElementById("aHintText");

      if(aScore) aScore.textContent = score10.toFixed(1);

      // âœ… ç‹€æ…‹é–€æª»ï¼ˆä½ å¯è‡ªè¡Œèª¿æ•´ï¼‰
      let status = "ç‹€æ…‹ä¸éŒ¯";
      if(score10 >= 8.5) status = "ä»Šå¤©ç‹€æ…‹æ¥µä½³";
      else if(score10 >= 7.0) status = "ä»Šå¤©ç‹€æ…‹è‰¯å¥½";
      else if(score10 >= 6.0) status = "ä»Šå¤©ç•¥ç–²æ†Š";
      else status = "ä»Šå¤©ç‹€æ…‹ä¸ä½³";
      if(aStatusText) aStatusText.textContent = status;

      // âœ… æç¤ºå¥ï¼ˆä½ å¯è‡ªå·±æ›æ–‡æ¡ˆï¼‰
      if(aHintText){
        aHintText.textContent =
          score10 < 6.0
            ? "å¥½æ¶ˆæ¯ï¼šæ°£è‰²å¯åœ¨ 5 åˆ†é˜å…§æ”¹å–„ï¼"
            : "ç¶­æŒä½ï¼åš 2â€“3 åˆ†é˜æŒ‰æ‘©æœƒæ›´äº®ã€‚";
      }
    }

    function loadUserPhoto(){
      const img = document.getElementById("aUserPhoto");
      const block = document.getElementById("aPhotoBlock");
      if(!img || !block) return;

      // âœ… ä½ æœªä¾†å¦‚æœæŠŠç…§ç‰‡æ”¾é€² payloadï¼Œå°±ç”¨ payload.photo
      const fromPayload = payload.photo || payload.image || payload.photoDataUrl;

      // âœ… ä½ æ‹ç…§é å­˜ localStorage ç”¨é€™äº› key ä¹Ÿåƒå¾—åˆ°
      // å»ºè­°çµ±ä¸€å­˜ï¼šlocalStorage.setItem("user_photo", dataURL)
      const fromLS =
        localStorage.getItem("user_photo") ||
        localStorage.getItem("captured_photo") ||
        localStorage.getItem("photo");

      const src = fromPayload || fromLS;

      if(src){
        img.src = src;
        block.style.display = "block";
      }else{
        block.style.display = "none";
      }
    }

    // =========================================================
    // âœ… 4) æŠŠç¸½è¦½ä¸Šçš„æ–‡å­—å¡«ä¸Šå»
    // =========================================================
    document.getElementById("overallNum").textContent = overall;
    const scoreTag = document.getElementById("scoreTag");
    if (scoreTag) scoreTag.textContent = `Score ${overall}`;
    const aOverallNum = document.getElementById("aOverallNum");
    if (aOverallNum) aOverallNum.textContent = overall;
    document.getElementById("qualityChip").textContent = quality;

    const ts = payload.timestamp ? new Date(payload.timestamp) : new Date();
    document.getElementById("timestampChip").textContent = ts.toLocaleString();

    // åˆå§‹åŒ– Step A
    setStepAFromMetrics();
    loadUserPhoto();

    // =========================================================
    // âœ… 5) Radar Chartï¼ˆåŸç”Ÿ Canvasï¼‰
    // =========================================================
    function drawRadar(canvas, values, labels){
      if(!canvas) return;
      const ctx = canvas.getContext("2d");
      const W = canvas.width, H = canvas.height;
      ctx.clearRect(0,0,W,H);

      const cx = W/2, cy = H/2;
      const radius = Math.min(W, H) * 0.34;
      const N = labels.length;

      // èƒŒæ™¯åœˆ
      ctx.lineWidth = 1;
      for(let k=1;k<=8;k++){
        const r = radius * (k/8);
        ctx.beginPath();
        for(let i=0;i<N;i++){
          const a = (-Math.PI/2) + (i * 2*Math.PI / N);
          const x = cx + r * Math.cos(a);
          const y = cy + r * Math.sin(a);
          if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
        }
        ctx.closePath();
        ctx.strokeStyle = "rgba(0,0,0,.10)";
        ctx.stroke();
      }

      // è»¸ç·š + æ¨™ç±¤
      for(let i=0;i<N;i++){
        const a = (-Math.PI/2) + (i * 2*Math.PI / N);
        const x = cx + radius * Math.cos(a);
        const y = cy + radius * Math.sin(a);

        ctx.beginPath();
        ctx.moveTo(cx,cy);
        ctx.lineTo(x,y);
        ctx.strokeStyle = "rgba(0,0,0,.12)";
        ctx.stroke();

        const lx = cx + (radius + 18) * Math.cos(a);
        const ly = cy + (radius + 18) * Math.sin(a);
        ctx.fillStyle = "rgba(24,11,10,.72)";
        ctx.font = "12px -apple-system, Segoe UI, sans-serif";
        ctx.textAlign = (Math.cos(a) > 0.2) ? "left" : (Math.cos(a) < -0.2 ? "right" : "center");
        ctx.textBaseline = (Math.sin(a) > 0.2) ? "top" : (Math.sin(a) < -0.2 ? "bottom" : "middle");
        ctx.fillText(labels[i], lx, ly);
      }

      // æ•¸å€¼å€å¡Š
      const vals = values.map(v=> Math.max(0, Math.min(100, Number(v))) / 100);
      ctx.beginPath();
      for(let i=0;i<N;i++){
        const a = (-Math.PI/2) + (i * 2*Math.PI / N);
        const r = radius * vals[i];
        const x = cx + r * Math.cos(a);
        const y = cy + r * Math.sin(a);
        if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
      }
      ctx.closePath();

      ctx.fillStyle = "rgba(255,157,184,.22)";
      ctx.strokeStyle = "rgba(216,189,91,.85)";
      ctx.lineWidth = 2;
      ctx.fill();
      ctx.stroke();

      // é»
      for(let i=0;i<N;i++){
        const a = (-Math.PI/2) + (i * 2*Math.PI / N);
        const r = radius * vals[i];
        const x = cx + r * Math.cos(a);
        const y = cy + r * Math.sin(a);
        ctx.beginPath();
        ctx.arc(x,y,6,0,Math.PI*2);
        ctx.fillStyle = "rgba(216,189,91,.95)";
        ctx.fill();
        ctx.strokeStyle = "rgba(255,255,255,.9)";
        ctx.lineWidth = 1;
        ctx.stroke();
      }
    }

    // const radarValues = [metrics.glow, metrics.complexion, metrics.blemish, metrics.oilBalance, metrics.evenness];
    // const radarLabels = ["å…‰æ¾¤","æ°£è‰²","ç‘•ç–µ","æ²¹æ°´å¹³è¡¡","å‡å‹»åº¦"];

    const radarValues = [metrics.glow, metrics.complexion, metrics.blemish, metrics.oilBalance, metrics.evenness];
    const radarLabels = ["å…‰æ¾¤","æ°£è‰²","ç‘•ç–µ","æ²¹æ°´å¹³è¡¡","å‡å‹»åº¦"];

    // âœ… å¤–é é›·é”
    const radar = document.getElementById("radar");
    if (radar) drawRadar(radar, radarValues, radarLabels);

    // âœ… å…§é é›·é”ï¼ˆStep Aï¼‰
    const radarA = document.getElementById("radarA");
    if (radarA) drawRadar(radarA, radarValues, radarLabels);

    // âœ… å¦‚æœä½ é‚„æœ‰ Step B çš„é›·é”ä¹Ÿè¦åŒæ­¥ï¼Œå°±å†åŠ ï¼š
    const radarB = document.getElementById("radarB");
    if (radarB) drawRadar(radarB, radarValues, radarLabels);

    drawRadar(document.getElementById("radar"), radarValues, radarLabels);
    drawRadar(document.getElementById("detailRadar"), radarValues, radarLabels);

    // =========================================================
    // âœ… 6) Bar Chartï¼ˆDOM ç‰ˆï¼‰
    // =========================================================
    const bars = document.getElementById("bars");
    const barDefs = [
      ["å…‰æ¾¤", metrics.glow],
      ["æ°£è‰²", metrics.complexion],
      ["ç‘•ç–µ", metrics.blemish],
      ["æ²¹æ°´å¹³è¡¡", metrics.oilBalance],
      ["å‡å‹»åº¦", metrics.evenness],
    ];

    bars.innerHTML = "";
    for(const [label, val] of barDefs){
      const v = Math.max(0, Math.min(100, Number(val)));
      const row = document.createElement("div");
      row.className = "barRow";
      row.innerHTML = `
        <div class="barLabel">${label}</div>
        <div class="barTrack"><div class="barFill" style="width:${v}%"></div></div>
        <div class="barVal">${v}</div>
      `;
      bars.appendChild(row);
    }

    // =========================================================
    // âœ… 7) å°ˆæ¥­æ‘˜è¦å¡
    // =========================================================
    const summaryCards = document.getElementById("summaryCards");

    function addCard(title, val, hint){
      const div = document.createElement("div");
      div.className = "item";
      div.innerHTML = `
        <div style="display:flex; justify-content:space-between; gap:10px; align-items:center;">
          <div><span class="badge">${title}</span></div>
          <div style="font-weight:900;">${val}</div>
        </div>
        <div class="mutedText" style="margin-top:6px;">${hint}</div>
      `;
      summaryCards.appendChild(div);
    }

    summaryCards.innerHTML = "";
    addCard("æ°£è‰²", metrics.complexion, "åä½å¸¸è¦‹åŸå› ï¼šç¡çœ ä¸è¶³ã€èƒŒå…‰ã€å¦å®¹/æ¿¾é¡å¹²æ“¾ã€‚");
    addCard("è†šæ³", Math.round((metrics.blemish + metrics.evenness)/2), "ç‘•ç–µï¼‹å‡å‹»åº¦ä¸€èµ·çœ‹ï¼Œä»£è¡¨æ•´é«”è†šæ³ç©©å®šæ€§ã€‚");
    addCard("å…‰æ¾¤", metrics.glow, "å…‰æ¾¤èˆ‡å…‰ç·šå¾ˆç›¸é—œï¼šè‡ªç„¶å…‰ã€é¿å…ç›´å°„åå…‰æ›´æº–ã€‚");
    addCard("æ²¹æ°´å¹³è¡¡", metrics.oilBalance, "å¤ªæ²¹æˆ–å¤ªä¹¾éƒ½æœƒå½±éŸ¿å‡å‹»åº¦èˆ‡ç‘•ç–µï¼Œå»ºè­°è§€å¯Ÿ T å­—/å…©é °å·®ç•°ã€‚");

    // =========================================================
    // âœ… 8) é¢¨éšªæé†’
    // =========================================================
    const riskList = document.getElementById("riskList");
    const risks = [];
    if(metrics.complexion < 60) risks.push("æ°£è‰²åä½ï¼šå…ˆç¢ºèªå…‰ç·š + ç¡çœ ç‹€æ…‹ï¼ˆæ­¤ç‚ºåƒè€ƒï¼Œä¸ä»£è¡¨å¥åº·è¨ºæ–·ï¼‰ã€‚");
    if(metrics.blemish < 55) risks.push("ç‘•ç–µæŒ‡æ¨™åä½ï¼šå»ºè­°å…ˆå¾æ¸…æ½”ã€ä¿æ¿•èˆ‡é˜²æ›¬ä¸€è‡´æ€§é–‹å§‹ã€‚");
    if(metrics.oilBalance < 55) risks.push("æ²¹æ°´å¹³è¡¡åä½ï¼šå¯èƒ½éä¹¾/éæ²¹ï¼Œå»ºè­°ç°¡åŒ–ä¿é¤Šä¸¦è§€å¯Ÿ 3â€“7 å¤©ã€‚");
    if(risks.length === 0) risks.push("æ²’æœ‰æ˜é¡¯é¢¨éšªæŒ‡æ¨™ï¼Œç¶­æŒç›®å‰ä½œæ¯èˆ‡é˜²æ›¬ç¿’æ…£å³å¯ã€‚");

    riskList.innerHTML = "";
    risks.forEach(t=>{
      const div = document.createElement("div");
      div.className = "item";
      div.textContent = t;
      riskList.appendChild(div);
    });

    // =========================================================
    // âœ… 9) Step åˆ‡æ›ï¼ˆåŒé åˆ‡æ›ï¼‰
    // =========================================================
    function switchStep(outId, inId){
      const outE = document.getElementById(outId);
      const inE = document.getElementById(inId);
      if(!outE || !inE) return;

      outE.classList.remove("visible");
      setTimeout(() => {
        inE.classList.add("visible");
        window.scrollTo({ top: 0, behavior: "smooth" });
      }, 120);
    }

    // =========================================================
    // âœ… 10) Tipsï¼ˆæ°¸é æœ‰å…§å®¹ + æœƒä¾æŒ‡æ¨™é€£å‹•ï¼‰
    // =========================================================
    const tipsList = document.getElementById("tipsList");

    function uniqPush(arr, txt){
      if(!txt) return;
      if(!arr.includes(txt)) arr.push(txt);
    }

    const tipsBase = Array.isArray(payload.tips) && payload.tips.length
      ? payload.tips.filter(Boolean)
      : [];

    const tips = tipsBase.slice();

    if(metrics.complexion < 60){
      uniqPush(tips, "æ°£è‰²åä½ï¼šè‡ªç„¶å…‰å´å…‰é‡æ‹ï¼Œä¸¦æŠŠç¡çœ æ‹‰å›ï¼ˆææ—© 30â€“60 åˆ†é˜ä¸ŠåºŠæœ€æœ‰æ•ˆï¼‰ã€‚");
      uniqPush(tips, "æ—©é¤è£œæ°´ï¼‹è›‹ç™½è³ªï¼ˆè±†æ¼¿/è›‹/å„ªæ ¼ï¼‰èƒ½è®“æ°£è‰²æ›´ç©©ã€‚");
    }
    if(metrics.blemish < 55){
      uniqPush(tips, "ç‘•ç–µåä½ï¼šæ¸…æ½”æ”¹æº«å’Œï¼Œæ´—é¢ 40â€“60 ç§’ï¼Œé¿å…ç”¨åŠ›æ‘©æ“¦ã€‚");
      uniqPush(tips, "ç²‰åˆº/ç—˜ç—˜å¤šï¼šå…ˆç©©å®šä¿æ¿•ï¼‹é˜²æ›¬ï¼Œå†é€æ­¥åŠ å…¥åŠŸèƒ½å‹ç”¢å“ã€‚");
    }
    if(metrics.oilBalance < 55){
      uniqPush(tips, "æ²¹æ°´å¹³è¡¡åä½ï¼šå…ˆç°¡åŒ–ä¿é¤Š 3â€“7 å¤©è§€å¯Ÿï¼ˆè¶Šç°¡å–®è¶Šç©©ï¼‰ã€‚");
      uniqPush(tips, "ç™½å¤©ç”¨å¸æ²¹é¢ç´™è¼•å£“å³å¯ï¼Œåˆ¥éåº¦æ§æ²¹ã€‚");
    }
    if(metrics.glow < 60){
      uniqPush(tips, "å…‰æ¾¤åä½ï¼šé¿å…èƒŒå…‰èˆ‡é ‚å…‰ï¼Œç”¨çª—é‚Šè‡ªç„¶å´å…‰ï¼Œè·é›¢ 30â€“40cmã€‚");
      uniqPush(tips, "ä¿é¤Šå…ˆæŠŠä¿æ¿•å±¤åšå¥½ï¼ˆåŒ–å¦æ°´/ç²¾è¯ï¼‰å†åŠ é–æ°´ä¹³ã€‚");
    }
    if(metrics.evenness < 60){
      uniqPush(tips, "å‡å‹»åº¦åä½ï¼šé˜²æ›¬è¦ç©©å®šï¼Œä¸¦æ¸›å°‘æ‘©æ“¦ï¼ˆæ´—è‡‰/æ“¦æ‹­è¦æº«æŸ”ï¼‰ã€‚");
      uniqPush(tips, "å›ºå®šåŒä¸€æ™‚é–“é€£æ‹ 3 å¤©å†çœ‹è¶¨å‹¢ï¼Œå–®æ¬¡æ³¢å‹•å¾ˆå¸¸è¦‹ã€‚");
    }

    const tipFallback = [
      "å›ºå®šåŒä¸€æ™‚é–“ã€åŒä¸€å…‰ç·šæ‹ 3 å¤©ï¼Œè¶¨å‹¢æ¯”å–®æ¬¡æ›´å¯ä¿¡ã€‚",
      "ä¿é¤Šé †åºå…ˆç©©ï¼šæ¸…æ½” â†’ ä¿æ¿• â†’ é˜²æ›¬ï¼›åŠŸèƒ½å‹ç”¢å“ç­‰ç©©å®šå¾Œå†åŠ ã€‚",
      "æ‹æ”æ™‚é¿å…æ¿¾é¡ã€ç¾è‚Œã€èª‡å¼µè£œå…‰ï¼Œå¦å‰‡æŒ‡æ¨™æœƒè¢«å¹²æ“¾ã€‚",
      "å®¤å…§åé»ƒå…‰æœƒæ‹‰ä½æ°£è‰²èˆ‡å‡å‹»åº¦ï¼Œç›¡é‡é çª—è‡ªç„¶å…‰ã€‚",
      "ä»Šå¤©ç‹€æ…‹å·®åˆ¥æ€¥è‘—ä¸‹çµè«–ï¼šç”¨ 7 å¤©å¹³å‡å€¼æ›´æº–ã€‚"
    ];
    for(const t of tipFallback){
      if(tips.length >= 6) break;
      uniqPush(tips, t);
    }

    // âœ… é¡¯ç¤º Tipsï¼ˆç¸½è¦½ + è©³ç´°ï¼‰
    document.getElementById("tipsCount").textContent = `${tips.length} æ¢`;

    function renderTips(container, list){
      container.innerHTML = "";
      list.forEach((t, idx)=>{
        const div = document.createElement("div");
        div.className = "item";
        div.innerHTML = `<span class="badge">#${idx+1}</span> ${t}`;
        container.appendChild(div);
      });
    }
    renderTips(tipsList, tips.slice(0, 4)); // âœ… ç¸½è¦½å…ˆé¡¯ç¤ºå‰ 4 æ¢

    // =========================================================
    // âœ… 11) å•†å“æ¨è–¦ï¼ˆ100 å‡è³‡æ–™ + æ©«å‘ç„¡é™æ»‘ï¼‰
    // =========================================================
    const productList = document.getElementById("productList");
    const productListDetail = document.getElementById("productListDetail");

    function buildFakeProducts(total = 100){
      const tags = ["ä¿æ¿•","æ‰“åº•","å…‰æ¾¤","å‡å‹»åº¦","æ²¹æ°´å¹³è¡¡","ç‘•ç–µæ”¹å–„","ä¿®è­·","é˜²æ›¬","èˆ’ç·©","æ€¥æ•‘"];
      const descs = [
        "é©åˆæ—¥å¸¸ç¶­ç©©ï¼Œå…ˆæŠŠåº•ç›¤é¡§å¥½ã€‚",
        "é‡å°å¼±é …åŠ å¼·ï¼Œå»ºè­°é€£çºŒä½¿ç”¨ 7 å¤©è§€å¯Ÿè¶¨å‹¢ã€‚",
        "æº«å’Œè·¯ç·šï¼Œé™ä½åˆºæ¿€ã€è®“è†šæ³æ›´ç©©ã€‚",
        "åŠ å¼·è£œæ°´èˆ‡ä¿®è­·ï¼Œå…‰æ¾¤é€šå¸¸æœƒä¸€èµ·æå‡ã€‚",
        "æ­é…é˜²æ›¬æ›´æœ‰æ•ˆï¼Œå‡å‹»åº¦æå‡æ›´æ˜é¡¯ã€‚"
      ];
      return Array.from({ length: total }, (_, i) => {
        const tag = tags[i % tags.length];
        const desc = descs[i % descs.length];
        return {
          name: `æ¸¬è©¦å•†å“ ${String(i + 1).padStart(3, "0")}`,
          desc,
          tag,
          url: "#",
          image: "assets/background.jpg"
        };
      });
    }

    const backendProducts = Array.isArray(payload.products) ? payload.products.filter(Boolean) : [];
    const TARGET = 100;

    const ALL_PRODUCTS =
      backendProducts.length >= TARGET
        ? backendProducts.slice(0, TARGET)
        : backendProducts.concat(buildFakeProducts(TARGET - backendProducts.length));

    // const ALL_PRODUCTS =
    //   (Array.isArray(payload.products) && payload.products.length)
    //     ? payload.products
    //     : buildFakeProducts(100);

    let page = 0;
    const PAGE_SIZE = 8;
    let loading = false;
    let pageDetail = 0;
    const PAGE_SIZE_DETAIL = 8;
    let loadingDetail = false;

    function createProductCard(p){
      const div = document.createElement("div");
      div.className = "item productCard fade-in";
      div.dataset.kind = "product";
      const imgUrl = p.image || p.img || p.photo || "assets/background.jpg";
      div.innerHTML = `
        <img class="productImg" src="${imgUrl}" alt="${p.name || "å•†å“"}" />
        <div class="productBody">
          <div class="productTitle">${p.name || "æ¨è–¦é …ç›®"}</div>
          <div class="mutedText">${p.desc || "å»ºè­°æ–¹å‘ï¼šä¾ä½ çš„æŒ‡æ¨™å¼±é …å„ªå…ˆè£œå¼·ã€‚"}</div>
          <div class="productMeta">
            <span class="badge">${p.tag || "å»ºè­°"}</span>
            <a class="productCta" href="${p.url || "#"}" target="_blank" rel="noopener">æŸ¥çœ‹</a>
          </div>
        </div>
      `;
      return div;
    }

    function updateProductCount(){
      const cards = productList.querySelectorAll('[data-kind="product"]');
      document.getElementById("productCount").textContent = `${cards.length} é …`;
    }
    function updateProductCount2(){
      if(!productListDetail) return;
      const cards = productListDetail.querySelectorAll('[data-kind="product"]');
      const productCount2 = document.getElementById("productCount2");
      if (productCount2) productCount2.textContent = `${cards.length} é …`;
    }

    function loadMoreX(){
      if(loading) return;
      loading = true;

      const start = page * PAGE_SIZE;
      const end = start + PAGE_SIZE;
      const slice = ALL_PRODUCTS.slice(start, end);

      if(slice.length === 0){
        sentinelXText.textContent = "å·²ç¶“åˆ°åº•äº†";
        loading = false;
        return;
      }

      slice.forEach(p => {
        const card = createProductCard(p);
        productList.insertBefore(card, sentinelX);
      });

      page++;
      updateProductCount();
      loading = false;
    }

    function loadMoreDetail(){
      if(!productListDetail || loadingDetail) return;
      loadingDetail = true;

      const start = pageDetail * PAGE_SIZE_DETAIL;
      const end = start + PAGE_SIZE_DETAIL;
      const slice = ALL_PRODUCTS.slice(start, end);

      if(slice.length === 0){
        sentinelDetailText.textContent = "å·²ç¶“åˆ°åº•äº†";
        loadingDetail = false;
        return;
      }

      slice.forEach(p => {
        const card = createProductCard(p);
        productListDetail.insertBefore(card, sentinelDetail);
      });

      pageDetail++;
      updateProductCount2();
      loadingDetail = false;
    }

    // sentinelï¼ˆåœ¨æœ€å³é‚Šï¼‰
    const sentinelX = document.createElement("div");
    sentinelX.id = "productSentinelX";
    const sentinelXText = document.createElement("div");
    sentinelXText.textContent = "å¾€å³æ»‘è¼‰å…¥æ›´å¤š â†’";
    sentinelX.appendChild(sentinelXText);

    const sentinelDetail = document.createElement("div");
    sentinelDetail.id = "productSentinelDetail";
    const sentinelDetailText = document.createElement("div");
    sentinelDetailText.textContent = "å¾€å³æ»‘è¼‰å…¥æ›´å¤š â†’";
    sentinelDetail.appendChild(sentinelDetailText);

    // åˆå§‹åŒ–å•†å“åˆ—
    productList.innerHTML = "";
    productList.appendChild(sentinelX);
    page = 0;
    loadMoreX();

    // å•†å“æ¨è–¦å…§é ï¼ˆåŒå¤–é æ¨£å¼ + æ©«å‘æ»‘å‹•ï¼‰
    if (productListDetail) {
      productListDetail.innerHTML = "";
      productListDetail.appendChild(sentinelDetail);
      pageDetail = 0;
      loadMoreDetail();
    }


    // IntersectionObserverï¼šroot è¨­ç‚ºæ©«å‘å®¹å™¨ productList
    const ioX = new IntersectionObserver((entries) => {
      const e = entries[0];
      if(e.isIntersecting){
        loadMoreX();
      }
    }, {
      root: productList,
      rootMargin: "0px 420px 0px 0px",
      threshold: 0
    });

    ioX.observe(sentinelX);

    if (productListDetail) {
      const ioDetail = new IntersectionObserver((entries) => {
        const e = entries[0];
        if(e.isIntersecting){
          loadMoreDetail();
        }
      }, {
        root: productListDetail,
        rootMargin: "0px 420px 0px 0px",
        threshold: 0
      });

      ioDetail.observe(sentinelDetail);
    }
  </script>
</body>
<script src="assets/app.js"></script>
</html>
