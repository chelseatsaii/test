<!doctype html>
<html lang="zh-TW">

<head>
    <meta charset="utf-8" />
    <meta name="robots" content="noindex, nofollow">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <title>åˆ†æçµæœ</title>
    <link rel="stylesheet" href="css/app.css" />
    <link rel="stylesheet" href="css/action-recommendations.css" />

    <style>
        /* ========================================
       é˜²æ­¢æ‰‹æ©Ÿå·¦å³æ™ƒå‹•
       ======================================== */
        html,
        body {
            overflow-x: hidden;
            max-width: 100vw;
        }

        /* ========================================
       ç¸½è¦½é æ¨£å¼
       ======================================== */
        .overview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .section-card {
            padding: 20px;
            border-radius: 18px;
            background: rgba(255, 255, 255, .95);
            border: 1px solid rgba(0, 0, 0, .08);
            box-shadow: 0 12px 40px rgba(0, 0, 0, .08);
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .section-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 16px 50px rgba(0, 0, 0, .12);
        }

        .section-title {
            font-size: 18px;
            font-weight: 900;
            margin-bottom: 12px;
            color: var(--text-dark);
        }

        .section-preview {
            font-size: 14px;
            color: var(--muted);
            line-height: 1.6;
        }

        .section-score {
            font-size: 36px;
            font-weight: 900;
            background: linear-gradient(135deg, var(--accent), var(--accent-light));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin: 12px 0;
        }

        .section-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: var(--radius-full);
            font-size: 11px;
            font-weight: 700;
            background: rgba(255, 155, 130, 0.12);
            color: var(--accent-dark);
            margin-top: 8px;
        }

        /* Aå€ç‰¹æ®Šæ¨£å¼ - å·¦å³ä½ˆå±€ */
        .section-card.card-a {
            display: flex;
            gap: 20px;
            align-items: center;
            /* ç§»é™¤ç‰¹æ®ŠèƒŒæ™¯ï¼Œçµ±ä¸€ä½¿ç”¨ç™½è‰² */
        }

        .card-left {
            flex-shrink: 0;
        }

        .card-right {
            flex: 1;
        }

        /* Bå€ç‰¹æ®Šæ¨£å¼ - å·¦å³ä½ˆå±€ */
        .section-card.card-b {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .card-b .radar-preview {
            flex-shrink: 0;
            width: 140px;
            height: 110px;
            margin: 0;
        }

        /* å·¦å´å…§å®¹å€ */
        .card-b .card-left {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        /* B å€å¾½ç« å‚ç›´æ’åˆ— */
        .card-b .top-issues-badges {
            flex-direction: column;
            gap: 8px;
            margin: 8px 0;
        }

        .card-b .issue-badge {
            width: 100%;
        }

        /* åœ“å½¢åˆ†æ•¸ */
        .score-circle {
            width: 90px;
            height: 90px;
            border-radius: 50%;
            background: rgba(255, 255, 255, .95);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, .08);
        }

        .score-number {
            font-size: 32px;
            font-weight: 900;
            color: var(--accent);
            line-height: 1;
        }

        .score-label {
            font-size: 10px;
            color: var(--muted);
            margin-top: 4px;
        }

        .action-list {
            display: flex;
            flex-direction: column;
            gap: 6px;
            margin-top: 8px;
        }

        .action-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            color: var(--text);
        }

        .item-icon {
            font-size: 16px;
            flex-shrink: 0;
        }

        /* å¿«é€Ÿæ‘˜è¦æ¨£å¼ */
        .quick-summary {
            display: flex;
            align-items: flex-start;
            gap: 8px;
            margin: 8px 0;
            padding: 10px 12px;
            border-radius: 10px;
            font-size: 13px;
            line-height: 1.5;
        }

        .quick-summary.positive {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.08), rgba(16, 185, 129, 0.04));
            border-left: 3px solid rgba(16, 185, 129, 0.6);
        }

        .quick-summary.attention {
            background: linear-gradient(135deg, rgba(255, 155, 130, 0.08), rgba(255, 155, 130, 0.04));
            border-left: 3px solid rgba(255, 155, 130, 0.6);
        }

        .summary-icon {
            font-size: 16px;
            flex-shrink: 0;
            line-height: 1.5;
        }

        .quick-summary span:last-child {
            flex: 1;
            color: var(--text);
        }

        /* B å€ Top 2 å•é¡Œå¾½ç« æ¨£å¼ */
        .top-issues-badges {
            display: flex;
            gap: 10px;
            margin: 12px 0;
            flex-wrap: wrap;
        }

        .issue-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 12px;
            border-radius: 12px;
            font-size: 13px;
            font-weight: 600;
            background: rgba(255, 255, 255, 0.6);
            border: 1px solid rgba(0, 0, 0, 0.08);
            transition: all 0.2s;
        }

        .issue-badge:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .issue-badge.severe {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.12), rgba(239, 68, 68, 0.06));
            border-color: rgba(239, 68, 68, 0.3);
        }

        .issue-badge.warning {
            background: linear-gradient(135deg, rgba(251, 146, 60, 0.12), rgba(251, 146, 60, 0.06));
            border-color: rgba(251, 146, 60, 0.3);
        }

        .issue-badge.moderate {
            background: linear-gradient(135deg, rgba(234, 179, 8, 0.12), rgba(234, 179, 8, 0.06));
            border-color: rgba(234, 179, 8, 0.3);
        }

        .badge-icon {
            font-size: 16px;
            line-height: 1;
        }

        .badge-name {
            color: var(--text-dark);
        }

        .badge-score {
            color: var(--muted);
            font-size: 12px;
            font-weight: 500;
        }

        /* C å€ç”Ÿæ´»å»ºè­°å¾½ç« æ¨£å¼ */
        .lifestyle-badges {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin: 12px 0;
        }

        .advice-badge {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 14px;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.7);
            border: 1px solid rgba(0, 0, 0, 0.06);
            transition: all 0.2s;
        }

        .advice-badge:hover {
            transform: translateX(4px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        .advice-icon {
            font-size: 20px;
            flex-shrink: 0;
            line-height: 1;
        }

        .advice-text {
            flex: 1;
            font-size: 13px;
            color: var(--text);
            line-height: 1.5;
        }

        /* ========================================
       è©³æƒ…é  - å…¨è¢å¹•æ»¾å‹•
       ======================================== */
        .detail-container {
            display: none;
            height: 100vh;
            overflow-y: scroll;
            scroll-snap-type: y mandatory;
            scroll-behavior: smooth;
        }

        .detail-container.active {
            display: block;
        }

        .detail-section {
            min-height: 100vh;
            scroll-snap-align: start;
            padding: 100px 20px 60px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
        }

        .detail-content {
            width: 100%;
            max-width: 800px;
            background: rgba(255, 255, 255, .95);
            border-radius: 22px;
            padding: 32px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, .10);
            box-sizing: border-box;
            overflow: hidden;
        }

        .scroll-hint {
            text-align: center;
            margin-top: 24px;
            font-size: 13px;
            color: var(--muted);
            animation: bounce 2s infinite;
        }

        @keyframes bounce {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-8px);
            }
        }

        /* ========================================
       æ©«å‘æ»‘å‹•å¡ç‰‡
       ======================================== */
        .horizontal-scroll {
            display: flex;
            gap: 16px;
            overflow-x: auto;
            overflow-y: hidden;
            padding: 16px 0;
            scroll-snap-type: x mandatory;
            -webkit-overflow-scrolling: touch;
            width: 100%;
            max-width: 100%;
        }

        .horizontal-scroll::-webkit-scrollbar {
            height: 8px;
        }

        .horizontal-scroll::-webkit-scrollbar-thumb {
            background: rgba(0, 0, 0, .15);
            border-radius: 999px;
        }

        .product-card {
            flex: 0 0 240px;
            scroll-snap-align: start;
            background: rgba(255, 255, 255, .80);
            border-radius: 16px;
            overflow: hidden;
            border: 1px solid rgba(0, 0, 0, .08);
        }

        .product-image {
            width: 100%;
            height: 180px;
            object-fit: cover;
            background: #f5f5f5;
        }

        .product-info {
            padding: 16px;
        }

        .product-brand {
            font-size: 12px;
            color: var(--muted);
            margin-bottom: 4px;
        }

        .product-name {
            font-size: 14px;
            font-weight: 700;
            margin-bottom: 8px;
            color: var(--text-dark);
        }

        .product-ingredient {
            font-size: 12px;
            color: var(--muted);
            margin-bottom: 12px;
        }

        .product-links {
            display: flex;
            gap: 8px;
        }

        .product-link {
            flex: 1;
            padding: 8px;
            text-align: center;
            font-size: 12px;
            border-radius: 8px;
            border: 1px solid rgba(0, 0, 0, .12);
            background: rgba(255, 255, 255, .90);
            text-decoration: none;
            color: var(--text);
            transition: all 0.2s;
        }

        .product-link:hover {
            background: rgba(255, 155, 130, 0.12);
            border-color: var(--accent);
        }

        /* ========================================
       æŒ‰éˆ•æ¨£å¼
       ======================================== */
        .back-btn {
            position: fixed;
            top: 24px;
            left: 24px;
            z-index: 100;
            padding: 12px 20px;
            background: rgba(255, 255, 255, .90);
            border: 1px solid rgba(0, 0, 0, .10);
            border-radius: 999px;
            font-size: 14px;
            cursor: pointer;
            box-shadow: 0 8px 24px rgba(0, 0, 0, .12);
            transition: all 0.2s;
        }

        .back-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 32px rgba(0, 0, 0, .16);
        }

        .save-report-btn {
            width: 100%;
            max-width: 400px;
            margin: 32px auto 0;
            padding: 16px 32px;
            background: linear-gradient(135deg, var(--accent), var(--accent-light));
            border: none;
            border-radius: var(--radius-full);
            font-size: 16px;
            font-weight: 900;
            color: white;
            cursor: pointer;
            box-shadow: 0 12px 32px rgba(255, 155, 130, 0.25);
            transition: all 0.3s;
        }

        .save-report-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 16px 40px rgba(255, 155, 130, 0.35);
        }

        /* ========================================
       é›·é”åœ–æ¨£å¼
       ======================================== */
        .radar-preview {
            width: 100%;
            max-width: 200px;
            height: 150px;
            margin: 16px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-light);
            font-size: 12px;
        }

        .massage-card {
            background: rgba(255, 255, 255, .95);
            border-radius: 16px;
            padding: 20px;
            margin: 16px 0;
            border: 1px solid rgba(0, 0, 0, .08);
            width: 100%;
            max-width: 100%;
            box-sizing: border-box;
            overflow: hidden;
        }

        .massage-gif {
            width: 100%;
            max-width: 300px;
            height: 200px;
            background: var(--bg-secondary);
            border-radius: 12px;
            margin: 12px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-light);
            font-size: 13px;
        }

        /* ========================================
       AI è¨ºæ–·å€å¡Šæ¨£å¼
       ======================================== */
        .diagnosis-positive {
            padding: 16px;
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.08), rgba(16, 185, 129, 0.04));
            border-left: 4px solid var(--accent);
            border-radius: 12px;
            margin-bottom: 16px;
        }

        .diagnosis-positive p {
            margin: 0;
            line-height: 1.7;
            color: var(--text);
        }

        .diagnosis-problems {
            padding: 16px;
            background: linear-gradient(135deg, rgba(255, 155, 130, 0.08), rgba(255, 155, 130, 0.04));
            border-left: 4px solid var(--accent-dark);
            border-radius: 12px;
        }

        .diagnosis-problems h4 {
            font-size: 14px;
            font-weight: 700;
            margin: 0 0 8px 0;
            color: var(--text-dark);
        }

        .diagnosis-problems p {
            margin: 0;
            line-height: 1.7;
            color: var(--text);
        }

        /* ========================================
       æŒ‰æ‘©å¡ç‰‡æ¨£å¼
       ======================================== */
        .massage-item {
            flex: 0 0 300px;
            scroll-snap-align: start;
            background: rgba(255, 255, 255, .90);
            border-radius: 16px;
            overflow: hidden;
            border: 1px solid rgba(0, 0, 0, .08);
            box-shadow: 0 4px 12px rgba(0, 0, 0, .06);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .massage-item:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, .10);
        }

        .massage-gif-container {
            width: 100%;
            height: 200px;
            background: var(--bg-secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .massage-gif-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .massage-info {
            padding: 16px;
        }

        .massage-name {
            font-size: 16px;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 4px;
        }

        .massage-duration {
            font-size: 12px;
            color: var(--accent);
            font-weight: 600;
            margin-bottom: 12px;
        }

        .massage-steps,
        .massage-benefits {
            font-size: 13px;
            line-height: 1.6;
            margin-bottom: 12px;
        }

        .massage-steps strong,
        .massage-benefits strong {
            display: block;
            color: var(--text-dark);
            margin-bottom: 4px;
            font-size: 12px;
        }

        .massage-steps p,
        .massage-benefits p {
            margin: 0;
            color: var(--muted);
            white-space: pre-line;
        }

        /* ========================================
       æ‰‹æ©Ÿç‰ˆèª¿æ•´
       ======================================== */
        @media (max-width: 768px) {
            .stage {
                padding-left: 12px;
                padding-right: 12px;
            }

            .detail-section {
                padding: 80px 12px 40px;
            }

            .detail-content {
                padding: 24px 16px;
            }

            .back-btn {
                top: 16px;
                left: 16px;
                font-size: 13px;
                padding: 10px 16px;
            }

            .massage-item {
                flex: 0 0 280px;
            }

            /* A å€æ‰‹æ©Ÿç‰ˆèª¿æ•´ */
            .section-card.card-a {
                flex-direction: column;
                text-align: center;
            }

            .score-circle {
                width: 80px;
                height: 80px;
            }

            .score-number {
                font-size: 28px;
            }

            .quick-summary {
                text-align: left;
            }

            /* B å€æ‰‹æ©Ÿç‰ˆèª¿æ•´ */
            .section-card.card-b {
                flex-direction: column-reverse;
                /* å…§å®¹åœ¨ä¸Šï¼Œé›·é”åœ–åœ¨ä¸‹ */
            }

            .card-b .radar-preview {
                width: 100%;
                max-width: 200px;
                height: 150px;
                margin: 0 auto 16px auto;
                /* ä¸‹æ–¹ç•™é–“è· */
            }
        }
    </style>
</head>

<body>
    <!-- ========================================
       ç¸½è¦½é é¢
       ======================================== -->
    <div id="overview-page">
        <header>
            <div class="brand">
                <div class="logo"></div>
                <div>
                    <h1>åˆ†æçµæœ</h1>
                    <p>AI çš®è†šåˆ†æå ±å‘Š</p>
                </div>
            </div>
        </header>

        <div class="stage">
            <div class="card" style="max-width: 1000px;">
                <div class="card-head">
                    <div>
                        <div class="title">æ‚¨çš„è†šæ³åˆ†æå ±å‘Š</div>
                        <div class="sub">é»æ“Šä»»ä¸€å€åŸŸæŸ¥çœ‹è©³ç´°è³‡è¨Š</div>
                    </div>
                </div>

                <div class="body">
                    <!-- 4å€‹å€åŸŸå¡ç‰‡ -->
                    <div class="overview-grid">
                        <!-- Aå€ - æ´»åŠ›æ°£è‰²æŒ‡å— -->
                        <div class="section-card card-a" onclick="showDetail('section-a')">
                            <div class="card-left">
                                <div class="score-circle">
                                    <div class="score-number" id="overview-score-a">78</div>
                                    <div class="score-label">æ°£è‰²åˆ†æ•¸</div>
                                </div>
                            </div>
                            <div class="card-right">
                                <div class="section-title">A. æ´»åŠ›æ°£è‰²æŒ‡å—</div>

                                <!-- æ­£é¢è©•åƒ¹æ‘˜è¦ -->
                                <div class="quick-summary positive">
                                    <span class="summary-icon">âœ¨</span>
                                    <span id="overview-positive-summary">æ°£è‰²æ•´é«”ç©©å®šï¼Œè†šè‰²å‡å‹»åº¦è‰¯å¥½</span>
                                </div>

                                <!-- ä¸»è¦é—œæ³¨é» -->
                                <div class="quick-summary attention">
                                    <span class="summary-icon">âš ï¸</span>
                                    <span id="overview-attention-summary">çœ¼å‘¨å€åŸŸç•¥é¡¯ç–²æ…‹</span>
                                </div>

                                <div class="section-badge">é»æ“ŠæŸ¥çœ‹å®Œæ•´åˆ†æ â†’</div>
                            </div>
                        </div>

                        <!-- Bå€ - æ™ºèƒ½è†šæ³è§£æ -->
                        <div class="section-card card-b" onclick="showDetail('section-b')">
                            <!-- å·¦å´ï¼šå…§å®¹ -->
                            <div class="card-left">
                                <div class="section-title">B. æ™ºèƒ½è†šæ³è§£æ</div>

                                <!-- Top 2 å•é¡Œå¾½ç«  -->
                                <div class="top-issues-badges" id="top-issues-badges">
                                    <!-- å‹•æ…‹æ¸²æŸ“ -->
                                    <div class="issue-badge severe">
                                        <span class="badge-icon">ğŸ”´</span>
                                        <span class="badge-name">é»‘çœ¼åœˆ</span>
                                        <span class="badge-score">(7.8)</span>
                                    </div>
                                    <div class="issue-badge warning">
                                        <span class="badge-icon">ğŸŸ </span>
                                        <span class="badge-name">æ–‘</span>
                                        <span class="badge-score">(6.9)</span>
                                    </div>
                                </div>

                                <div class="section-badge">é»æ“ŠæŸ¥çœ‹è©³æƒ… â†’</div>
                            </div>

                            <!-- å³å´ï¼šé›·é”åœ– -->
                            <div class="radar-preview">
                                <canvas id="radar-chart-overview" width="200" height="150"
                                    style="display:block; margin:0 auto;"></canvas>
                            </div>
                        </div>

                        <!-- Cå€ - ç”±å…§è€Œå¤–é¤Šè†š -->
                        <div class="section-card" onclick="showDetail('section-c')">
                            <div class="section-title">C. ç”±å…§è€Œå¤–é¤Šè†š</div>

                            <!-- ç”Ÿæ´»å»ºè­°å¾½ç«  -->
                            <div class="lifestyle-badges" id="lifestyle-badges">
                                <!-- å‹•æ…‹æ¸²æŸ“ -->
                                <div class="advice-badge">
                                    <span class="advice-icon">ğŸ¥—</span>
                                    <span class="advice-text">ç‡Ÿé¤Šï¼šå¢åŠ è”¬æœã€æ¸›å°‘æ²¹ç‚¸</span>
                                </div>
                                <div class="advice-badge">
                                    <span class="advice-icon">ğŸ˜´</span>
                                    <span class="advice-text">ä½œæ¯ï¼šæ¯æ™š 7-8 å°æ™‚ç¡çœ </span>
                                </div>
                                <div class="advice-badge">
                                    <span class="advice-icon">ğŸƒ</span>
                                    <span class="advice-text">é‹å‹•ï¼šæ¯é€±è‡³å°‘ 3 æ¬¡é‹å‹•</span>
                                </div>
                            </div>

                            <div class="section-badge">é»æ“ŠæŸ¥çœ‹è©³æƒ… â†’</div>
                        </div>

                        <!-- Då€ - æ™ºæ…§é…æ–¹ -->
                        <div class="section-card" onclick="showDetail('section-d')">
                            <div class="section-title">D. æ™ºæ…§é…æ–¹</div>
                            <div class="section-preview">
                                <strong>6 æ¬¾</strong> ç²¾é¸ç”¢å“æ¨è–¦
                            </div>
                            <div class="section-badge">é»æ“ŠæŸ¥çœ‹è©³æƒ… â†’</div>
                        </div>
                    </div>

                    <!-- å„²å­˜å ±å‘ŠæŒ‰éˆ• -->
                    <button class="save-report-btn" onclick="saveToLine()">
                        å„²å­˜æˆ‘çš„å ±å‘Š
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ========================================
       è©³æƒ…é é¢ - å…¨è¢å¹•æ»¾å‹•
       ======================================== -->
    <div id="detail-page" class="detail-container">
        <button class="back-btn" onclick="backToOverview()">â† è¿”å›ç¸½è¦½</button>

        <!-- Aå€è©³æƒ… - æ´»åŠ›æ°£è‰²æŒ‡å— -->
        <div class="detail-section" data-section="llm_analysis">
            <div class="detail-content">
                <h2 style="margin-top:0;">A. æ´»åŠ›æ°£è‰²æŒ‡å—</h2>

                <!-- ä½¿ç”¨è€…ç…§ç‰‡ -->
                <div style="text-align:center; margin:20px 0;">
                    <img id="user-photo-a"
                        style="max-width:100%; max-height:300px; border-radius:16px; display:none;" />
                    <div style="font-size:13px; color:rgba(24,11,10,.60); margin-top:8px;">æ‚¨çš„æ‹æ”ç…§ç‰‡</div>
                </div>

                <!-- AI è¨ºæ–· -->
                <div class="massage-card">
                    <h3>ğŸ’¬ AI æ°£è‰²è¨ºæ–·</h3>

                    <!-- æ­£é¢è©•åƒ¹ -->
                    <div class="diagnosis-positive">
                        <p id="ai-positive-feedback">æ‚¨çš„æ°£è‰²æ•´é«”ç©©å®šï¼Œè†šè‰²å‡å‹»åº¦è‰¯å¥½ï¼Œé¡¯ç¤ºå‡ºè‰¯å¥½çš„ä½œæ¯èˆ‡ä¿é¤Šç¿’æ…£ã€‚å…‰æ¾¤åº¦é©ä¸­ï¼Œæ•´é«”å‘ˆç¾å¥åº·çš„è‡ªç„¶å…‰æ„Ÿã€‚</p>
                    </div>

                    <!-- å•é¡Œåˆ†æ -->
                    <div class="diagnosis-problems">
                        <h4>éœ€è¦é—œæ³¨çš„éƒ¨åˆ†</h4>
                        <p id="ai-problem-analysis">çœ¼å‘¨å€åŸŸç•¥é¡¯ç–²æ…‹ï¼Œå»ºè­°åŠ å¼·ä¿æ¿•èˆ‡æŒ‰æ‘©ä¿ƒé€²å¾ªç’°ã€‚T å­—éƒ¨ä½æ²¹è„‚åˆ†æ³Œç¨å¤šï¼Œå¯èª¿æ•´æ¸…æ½”é »ç‡ä¸¦é¸ç”¨æ¸…çˆ½å‹ä¿é¤Šå“ã€‚</p>
                    </div>
                </div>

                <!-- è¡Œå‹•æ¨è–¦ (LLM åµæ¸¬çµæœ) -->
                <div id="action-recommendations-container">
                    <!-- é€™è£¡æœƒå‹•æ…‹è¼‰å…¥è¡Œå‹•æ¨è–¦å¡ç‰‡ -->
                </div>

                <!-- æ¨è–¦æŒ‰æ‘© -->
                <div class="massage-card">
                    <h3>ğŸŒ¸ æ¨è–¦æŒ‰æ‘©</h3>
                    <div class="horizontal-scroll" id="massage-list">
                        <!-- å‹•æ…‹æ¸²æŸ“æŒ‰æ‘©å¡ç‰‡ -->
                    </div>
                </div>
            </div>
            <div class="scroll-hint">å¾€ä¸‹æ»‘å‹•æŸ¥çœ‹è†šæ³åˆ†æ â†“</div>
        </div>

        <!-- Bå€è©³æƒ… - æ™ºèƒ½è†šæ³è§£æ -->
        <div class="detail-section" data-section="model_detection">
            <div class="detail-content">
                <h2 style="margin-top:0;">B. æ™ºèƒ½è†šæ³è§£æ</h2>

                <!-- æ¨™è¨»åœ–ç‰‡ -->
                <div style="text-align:center; margin:20px 0;">
                    <img id="annotated-photo"
                        style="max-width:100%; max-height:300px; border-radius:16px; display:none;" />
                    <div style="font-size:13px; color:rgba(24,11,10,.60); margin-top:8px;">å•é¡Œå€åŸŸæ¨™è¨»åœ–</div>
                </div>

                <!-- äº”è§’é›·é”åœ– -->
                <div style="background:rgba(255,255,255,.80); border-radius:16px; padding:20px; margin:20px 0;">
                    <h3>äº”è§’åˆ†æåœ–</h3>
                    <canvas id="radar-chart" width="400" height="300" style="max-width:100%;"></canvas>
                    <div style="font-size:12px; color:rgba(24,11,10,.60); margin-top:12px; text-align:center;">
                        5 é …æŒ‡æ¨™: ç´°ç´‹ã€æ–‘ã€ç—˜ç—˜ã€ç²‰åˆºã€é»‘çœ¼åœˆ
                    </div>
                </div>

                <!-- æœ€åš´é‡çš„ 2 å€‹å•é¡Œ -->
                <div class="massage-card">
                    <h3>ä¸»è¦å•é¡Œ (æœ€åš´é‡çš„ 2 é …)</h3>
                    <div id="top-issues">
                        <div style="padding:12px; background:rgba(212,165,116,.08); border-radius:12px; margin:8px 0;">
                            <strong>å•é¡Œ 1: ç—˜ç—˜</strong><br>
                            åš´é‡ç¨‹åº¦: <strong>8/10</strong><br>
                            <span style="font-size:12px; color:rgba(24,11,10,.70);">T å­—éƒ¨ä½è¼ƒç‚ºæ˜é¡¯</span>
                        </div>
                        <div style="padding:12px; background:rgba(212,165,116,.08); border-radius:12px; margin:8px 0;">
                            <strong>å•é¡Œ 2: ç´°ç´‹</strong><br>
                            åš´é‡ç¨‹åº¦: <strong>7/10</strong><br>
                            <span style="font-size:12px; color:rgba(24,11,10,.70);">çœ¼å‘¨å€åŸŸ</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="scroll-hint">å¾€ä¸‹æ»‘å‹•æŸ¥çœ‹é£²é£Ÿå»ºè­° â†“</div>
        </div>

        <!-- Cå€è©³æƒ… - ç”±å…§è€Œå¤–é¤Šè†š -->
        <div class="detail-section" data-section="diet_advice">
            <div class="detail-content">
                <h2 style="margin-top:0;">C. ç”±å…§è€Œå¤–é¤Šè†š</h2>

                <!-- ç‡Ÿé¤Šè£œå…… -->
                <div class="massage-card">
                    <h3>ç‡Ÿé¤Šè£œå……å»ºè­°</h3>
                    <ul style="line-height:1.8;" id="nutrition-list">
                        <li>æ·±ç¶ è‰²è”¬èœ (è èœã€ç¾½è¡£ç”˜è—)</li>
                        <li>Omega-3 é£Ÿç‰© (é®­é­šã€æ ¸æ¡ƒ)</li>
                        <li>ç¶­ç”Ÿç´  C æ°´æœ (å¥‡ç•°æœã€æŸ‘æ©˜)</li>
                        <li>å …æœèˆ‡å…¨ç©€é¡</li>
                    </ul>
                </div>

                <!-- ä½œæ¯èª¿æ•´ -->
                <div class="massage-card">
                    <h3>ä½œæ¯èª¿æ•´å»ºè­°</h3>
                    <p id="sleep-detail">å»ºè­°å›ºå®šå°±å¯¢æ™‚é–“,æ¯æ™šç¡çœ  7-8 å°æ™‚,é€£çºŒ 7 å¤©è§€å¯Ÿæ°£è‰²è®ŠåŒ–ã€‚</p>
                </div>

                <!-- ç”Ÿæ´»ç¿’æ…£ -->
                <div class="massage-card">
                    <h3>ç”Ÿæ´»ç¿’æ…£æ”¹å–„</h3>
                    <p id="exercise-detail">ä¿æŒè¦å¾‹é‹å‹•,æ¯é€±è‡³å°‘ 3 æ¬¡,æ¯æ¬¡ 30 åˆ†é˜ã€‚é¿å…éåº¦æ›æ›¬,åšå¥½é˜²æ›¬æªæ–½ã€‚</p>
                </div>
            </div>
            <div class="scroll-hint">å¾€ä¸‹æ»‘å‹•æŸ¥çœ‹ç”¢å“æ¨è–¦ â†“</div>
        </div>

        <!-- Då€è©³æƒ… - æ™ºæ…§é…æ–¹ -->
        <div class="detail-section" data-section="product_recommendation">
            <div class="detail-content">
                <h2 style="margin-top:0;">D. æ™ºæ…§é…æ–¹</h2>

                <!-- é‡å°å•é¡Œ A çš„æˆåˆ† -->
                <div class="massage-card">
                    <h3>é‡å°ç—˜ç—˜å•é¡Œ</h3>
                    <p><strong>ä¸»æ”»æ‰‹:</strong> æ°´æ¥Šé…¸</p>
                    <p><strong>æ ¸å¿ƒæˆåˆ†:</strong> èŒ¶æ¨¹ç²¾æ²¹ã€ç…™é†¯èƒº</p>
                    <p style="font-size:13px; color:rgba(24,11,10,.70);">
                        æ°´æ¥Šé…¸èƒ½æ·±å…¥æ¯›å­”,æº¶è§£æ²¹è„‚å’Œè§’è³ª,æœ‰æ•ˆæ”¹å–„ç—˜ç—˜å•é¡Œã€‚
                    </p>
                </div>

                <!-- é‡å°å•é¡Œ B çš„æˆåˆ† -->
                <div class="massage-card">
                    <h3>é‡å°ç´°ç´‹å•é¡Œ</h3>
                    <p><strong>ä¸»æ”»æ‰‹:</strong> è¦–é»ƒé†‡ (Aé†‡)</p>
                    <p><strong>æ ¸å¿ƒæˆåˆ†:</strong> ç»å°¿é…¸ã€èƒœè‚½</p>
                    <p style="font-size:13px; color:rgba(24,11,10,.70);">
                        è¦–é»ƒé†‡èƒ½ä¿ƒé€²è† åŸè›‹ç™½ç”Ÿæˆ,æ¸›å°‘ç´°ç´‹å’Œçšºç´‹ã€‚
                    </p>
                </div>

                <!-- å•†å“æ¨è–¦ (6å€‹,æ©«å‘æ»‘å‹•) -->
                <div class="massage-card">
                    <h3>ç²¾é¸ç”¢å“æ¨è–¦</h3>
                    <div class="horizontal-scroll" id="product-list">
                        <!-- ç”¢å“ 1 -->
                        <div class="product-card">
                            <img class="product-image"
                                src="https://via.placeholder.com/240x180/D4A574/FFFFFF?text=Product+1" alt="ç”¢å“åœ–ç‰‡ 1">
                            <div class="product-info">
                                <div class="product-brand">å“ç‰Œåç¨± A</div>
                                <div class="product-name">æ°´æ¥Šé…¸æ·¨ç—˜ç²¾è¯</div>
                                <div class="product-ingredient">å«æœ‰: æ°´æ¥Šé…¸ã€èŒ¶æ¨¹ç²¾æ²¹</div>
                                <div class="product-links">
                                    <a href="#" class="product-link">å‰å¾€å®˜ç¶² â†’</a>
                                    <a href="#" class="product-link">å‰å¾€ momo â†’</a>
                                </div>
                            </div>
                        </div>

                        <!-- ç”¢å“ 2 -->
                        <div class="product-card">
                            <img class="product-image"
                                src="https://via.placeholder.com/240x180/E8D5B7/FFFFFF?text=Product+2" alt="ç”¢å“åœ–ç‰‡ 2">
                            <div class="product-info">
                                <div class="product-brand">å“ç‰Œåç¨± B</div>
                                <div class="product-name">Aé†‡æŠ—çšºç²¾è¯æ¶²</div>
                                <div class="product-ingredient">å«æœ‰: è¦–é»ƒé†‡ã€ç»å°¿é…¸</div>
                                <div class="product-links">
                                    <a href="#" class="product-link">å‰å¾€å®˜ç¶² â†’</a>
                                    <a href="#" class="product-link">å‰å¾€ momo â†’</a>
                                </div>
                            </div>
                        </div>

                        <!-- ç”¢å“ 3 -->
                        <div class="product-card">
                            <img class="product-image"
                                src="https://via.placeholder.com/240x180/D4A574/FFFFFF?text=Product+3" alt="ç”¢å“åœ–ç‰‡ 3">
                            <div class="product-info">
                                <div class="product-brand">å“ç‰Œåç¨± C</div>
                                <div class="product-name">ç…™é†¯èƒºäº®ç™½ç²¾è¯</div>
                                <div class="product-ingredient">å«æœ‰: ç…™é†¯èƒºã€ç¶­ç”Ÿç´ C</div>
                                <div class="product-links">
                                    <a href="#" class="product-link">å‰å¾€å®˜ç¶² â†’</a>
                                    <a href="#" class="product-link">å‰å¾€ momo â†’</a>
                                </div>
                            </div>
                        </div>

                        <!-- ç”¢å“ 4 -->
                        <div class="product-card">
                            <img class="product-image"
                                src="https://via.placeholder.com/240x180/E8D5B7/FFFFFF?text=Product+4" alt="ç”¢å“åœ–ç‰‡ 4">
                            <div class="product-info">
                                <div class="product-brand">å“ç‰Œåç¨± D</div>
                                <div class="product-name">ç»å°¿é…¸ä¿æ¿•ç²¾è¯</div>
                                <div class="product-ingredient">å«æœ‰: ç»å°¿é…¸ã€ç¥ç¶“é†¯èƒº</div>
                                <div class="product-links">
                                    <a href="#" class="product-link">å‰å¾€å®˜ç¶² â†’</a>
                                    <a href="#" class="product-link">å‰å¾€ momo â†’</a>
                                </div>
                            </div>
                        </div>

                        <!-- ç”¢å“ 5 -->
                        <div class="product-card">
                            <img class="product-image"
                                src="https://via.placeholder.com/240x180/D4A574/FFFFFF?text=Product+5" alt="ç”¢å“åœ–ç‰‡ 5">
                            <div class="product-info">
                                <div class="product-brand">å“ç‰Œåç¨± E</div>
                                <div class="product-name">èƒœè‚½ç·Šç·»ç²¾è¯</div>
                                <div class="product-ingredient">å«æœ‰: å…­èƒœè‚½ã€è† åŸè›‹ç™½</div>
                                <div class="product-links">
                                    <a href="#" class="product-link">å‰å¾€å®˜ç¶² â†’</a>
                                    <a href="#" class="product-link">å‰å¾€ momo â†’</a>
                                </div>
                            </div>
                        </div>

                        <!-- ç”¢å“ 6 -->
                        <div class="product-card">
                            <img class="product-image"
                                src="https://via.placeholder.com/240x180/E8D5B7/FFFFFF?text=Product+6" alt="ç”¢å“åœ–ç‰‡ 6">
                            <div class="product-info">
                                <div class="product-brand">å“ç‰Œåç¨± F</div>
                                <div class="product-name">ç¶­ç”Ÿç´ Cæ·¡æ–‘ç²¾è¯</div>
                                <div class="product-ingredient">å«æœ‰: ç¶­ç”Ÿç´ Cã€ç†Šæœç´ </div>
                                <div class="product-links">
                                    <a href="#" class="product-link">å‰å¾€å®˜ç¶² â†’</a>
                                    <a href="#" class="product-link">å‰å¾€ momo â†’</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- å„²å­˜å ±å‘ŠæŒ‰éˆ• -->
                <button class="save-report-btn" onclick="saveToLine()">
                    å„²å­˜æˆ‘çš„å ±å‘Š
                </button>
            </div>
        </div>
    </div>

    <div class="toast" id="toast"></div>

    <script type="module">
        import { drawRadar, safeJsonFetch, saveResult, loadResult, toast as appToast } from './js/utils.js';
        // ========================================
        // å·¥å…·å‡½æ•¸
        // ========================================
        function toast(msg) {
            appToast(msg);
        }

        // ========================================
        // é é¢åˆ‡æ›
        // ========================================
        function showDetail(sectionId) {
            document.getElementById('overview-page').style.display = 'none';
            document.getElementById('detail-page').classList.add('active');

            // æ»¾å‹•åˆ°å°æ‡‰å€åŸŸ
            const sectionMap = {
                'section-a': 0,
                'section-b': 1,
                'section-c': 2,
                'section-d': 3
            };

            const sections = document.querySelectorAll('.detail-section');
            const targetIndex = sectionMap[sectionId] || 0;
            sections[targetIndex].scrollIntoView({ behavior: 'smooth' });

            // å¦‚æœé€²å…¥ B å€ï¼ˆæ™ºèƒ½è†šæ³è§£æï¼‰ï¼Œç¹ªè£½é›·é”åœ–
            if (sectionId === 'section-b') {
                // ä½¿ç”¨ requestAnimationFrame ç¢ºä¿ DOM å®Œå…¨æ¸²æŸ“å¾Œæ‰ç¹ªè£½
                requestAnimationFrame(() => {
                    setTimeout(() => {
                        console.log('ğŸ¨ Now drawing radar chart for section B...');
                        const result = loadResult();
                        renderRadar(result);
                    }, 100);
                });
            }

            // GA è¿½è¹¤
            trackSection(sections[targetIndex].dataset.section);
        }

        function backToOverview() {
            document.getElementById('detail-page').classList.remove('active');
            document.getElementById('overview-page').style.display = 'block';
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // ========================================
        // GA è¿½è¹¤
        // ========================================
        function trackSection(sectionName) {
            if (typeof gtag !== 'undefined') {
                gtag('event', 'section_view', {
                    section_name: sectionName,
                    page_path: '/result#' + sectionName
                });
            }
            console.log('GA Track:', sectionName);
        }

        // Intersection Observer for auto-tracking
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const sectionName = entry.target.dataset.section;
                    trackSection(sectionName);
                }
            });
        }, {
            threshold: 0.5
        });

        // ç›£è½æ‰€æœ‰è©³æƒ…å€åŸŸ
        document.querySelectorAll('.detail-section').forEach(section => {
            observer.observe(section);
        });

        // ========================================
        // å„²å­˜å ±å‘Šåˆ° LINE
        // ========================================
        function saveToLine() {
            toast('æ­£åœ¨å„²å­˜å ±å‘Š...');
            // TODO: å¯¦ä½œ LINE å›å‚³åŠŸèƒ½
            setTimeout(() => {
                toast('å ±å‘Šå·²å„²å­˜!');
            }, 1000);
        }

        // ========================================
        // è¼‰å…¥è³‡æ–™
        // ========================================
        async function ensureResult() {
            const cached = loadResult();
            if (cached) return cached;

            const res = await safeJsonFetch('./api/mock_result.json', {}, null);
            if (res.ok && res.data) {
                saveResult(res.data);
                return res.data;
            }
            return null;
        }

        // å…±ç”¨çš„é›·é”åœ–ç¹ªè£½å‡½æ•¸
        function drawRadarChart(canvas, result) {
            if (!canvas) {
                console.error('Canvas element not found!');
                return;
            }

            // ç¢ºä¿ canvas æœ‰æ­£ç¢ºçš„å°ºå¯¸
            if (!canvas.width || !canvas.height) {
                canvas.width = canvas.id === 'radar-chart-overview' ? 200 : 400;
                canvas.height = canvas.id === 'radar-chart-overview' ? 150 : 300;
            }

            // å–å¾— b_scoresï¼ˆçš®è†šå•é¡Œåˆ†æ•¸ï¼‰ï¼Œå¦‚æœæ²’æœ‰å°±ç”¨é è¨­å€¼
            let bScores = result?.b_scores;
            if (!bScores) {
                console.warn('No b_scores data, using default values');
                bScores = {
                    wrinkles: 50,
                    spots: 60,
                    acne: 55,
                    comedones: 45,
                    darkCircles: 65
                };
            }

            const radarValues = {
                "ç´°ç´‹": Number(bScores.wrinkles ?? 0) * 10,
                "æ–‘": Number(bScores.spots ?? 0) * 10,
                "ç—˜ç—˜": Number(bScores.acne ?? 0) * 10,
                "ç²‰åˆº": Number(bScores.comedones ?? 0) * 10,
                "é»‘çœ¼åœˆ": Number(bScores.darkCircles ?? 0) * 10
            };

            console.log('drawRadarChart called with:', {
                canvasId: canvas.id,
                canvasSize: { width: canvas.width, height: canvas.height },
                bScores: bScores,
                radarValues: radarValues
            });

            try {
                drawRadar(canvas, radarValues);
                console.log(`âœ… Radar chart drawn successfully on ${canvas.id}!`);
            } catch (e) {
                console.error(`âŒ Error drawing radar on ${canvas.id}:`, e);
            }
        }

        // ç‚ºè©³æƒ…é  B å€ç¹ªè£½é›·é”åœ–
        function renderRadar(result) {
            const radar = document.getElementById('radar-chart');
            drawRadarChart(radar, result);
        }

        async function loadData() {
            console.log('loadData started');

            // å¾ localStorage æˆ– API è¼‰å…¥è³‡æ–™
            const result = await ensureResult();
            console.log('Result loaded:', result);

            if (result && result.overall) {
                // æ›´æ–° A å€åˆ†æ•¸
                const scoreEl = document.getElementById('overview-score-a');
                if (scoreEl) {
                    scoreEl.textContent = result.overall;
                }
            }

            // ğŸ¨ æ–°å¢ï¼šæ›´æ–°ç¸½è¦½é é¢çš„æ‘˜è¦
            updateOverviewSummary(result);

            // ğŸ¨ æ–°å¢ï¼šæ›´æ–° B å€ Top 2 å•é¡Œå¾½ç« 
            updateTopIssuesBadges(result);

            // ğŸ¨ æ–°å¢ï¼šæ›´æ–° C å€ç”Ÿæ´»å»ºè­°
            updateLifestyleAdvice(result);

            // è¼‰å…¥ä½¿ç”¨è€…ç…§ç‰‡
            const userPhoto = localStorage.getItem('user_photo');
            if (userPhoto) {
                const photoEl = document.getElementById('user-photo-a');
                if (photoEl) {
                    photoEl.src = userPhoto;
                    photoEl.style.display = 'block';
                }
            }

            // ç¹ªè£½ç¸½è¦½é é¢çš„é›·é”åœ–ï¼ˆç¸½è¦½é é¢æ˜¯å¯è¦‹çš„ï¼‰
            setTimeout(() => {
                const overviewRadar = document.getElementById('radar-chart-overview');
                if (overviewRadar) {
                    console.log('ğŸ¨ Drawing overview radar chart...');
                    drawRadarChart(overviewRadar, result);
                }
            }, 100);

            toast('è³‡æ–™è¼‰å…¥å®Œæˆ');
        }

        // ========================================
        // B å€ Top 2 å•é¡Œå¾½ç« æ›´æ–°
        // ========================================

        /**
         * å•é¡Œé¡å‹æ˜ å°„ï¼ˆä¸­æ–‡åç¨±èˆ‡åœ–ç¤ºï¼‰
         */
        const ISSUE_MAP = {
            wrinkles: { name: 'ç´°ç´‹', icon: 'ğŸ“' },
            spots: { name: 'æ–‘', icon: 'ğŸŸ¤' },
            acne: { name: 'ç—˜ç—˜', icon: 'ğŸ”´' },
            comedones: { name: 'ç²‰åˆº', icon: 'âšª' },
            darkCircles: { name: 'é»‘çœ¼åœˆ', icon: 'ğŸŒ‘' }
        };

        /**
         * æ ¹æ“šåˆ†æ•¸åˆ¤æ–·åš´é‡åº¦ç­‰ç´š
         * @param {number} score - åˆ†æ•¸ (0-10)
         * @returns {string} åš´é‡åº¦ç­‰ç´š: 'severe', 'warning', 'moderate'
         */
        function getSeverityLevel(score) {
            if (score >= 7) return 'severe';      // åš´é‡ (ç´…è‰²)
            if (score >= 5) return 'warning';     // è­¦å‘Š (æ©˜è‰²)
            return 'moderate';                     // ä¸­ç­‰ (é»ƒè‰²)
        }

        /**
         * å¾ b_scores ä¸­æ‰¾å‡ºæœ€åš´é‡çš„ 2 å€‹å•é¡Œ
         * @param {object} bScores - çš®è†šå•é¡Œåˆ†æ•¸
         * @returns {Array} Top 2 å•é¡Œé™£åˆ—
         */
        function getTopIssues(bScores) {
            if (!bScores) return [];

            const issues = Object.keys(ISSUE_MAP).map(key => ({
                key: key,
                name: ISSUE_MAP[key].name,
                icon: ISSUE_MAP[key].icon,
                score: Number(bScores[key] || 0)
            }));

            // æŒ‰åˆ†æ•¸æ’åºï¼Œå–å‰ 2 å
            return issues.sort((a, b) => b.score - a.score).slice(0, 2);
        }

        /**
         * æ›´æ–°ç¸½è¦½é é¢çš„ B å€ Top 2 å•é¡Œå¾½ç« 
         * @param {object} result - åˆ†æçµæœè³‡æ–™
         */
        function updateTopIssuesBadges(result) {
            const badgesContainer = document.getElementById('top-issues-badges');
            const issuesCountEl = document.getElementById('issues-count');

            if (!badgesContainer) {
                console.warn('Top issues badges container not found');
                return;
            }

            // å–å¾— b_scores
            const bScores = result?.b_scores;
            if (!bScores) {
                console.warn('No b_scores data for top issues');
                return;
            }

            // æ‰¾å‡º Top 2 å•é¡Œ
            const topIssues = getTopIssues(bScores);

            if (topIssues.length === 0) {
                badgesContainer.innerHTML = '<div style="color: var(--muted); font-size: 13px;">æš«ç„¡å•é¡Œè³‡æ–™</div>';
                return;
            }

            // æ›´æ–°å•é¡Œæ•¸é‡
            if (issuesCountEl) {
                issuesCountEl.textContent = topIssues.length;
            }

            // æ¸²æŸ“å¾½ç« 
            badgesContainer.innerHTML = topIssues.map(issue => {
                const severity = getSeverityLevel(issue.score);
                return `
                    <div class="issue-badge ${severity}">
                        <span class="badge-icon">${issue.icon}</span>
                        <span class="badge-name">${issue.name}</span>
                        <span class="badge-score">(${issue.score.toFixed(1)})</span>
                    </div>
                `;
            }).join('');

            console.log('âœ… Top issues badges updated:', topIssues);
        }

        // ========================================
        // C å€ç”Ÿæ´»å»ºè­°æ›´æ–°
        // ========================================

        /**
         * æ›´æ–°ç¸½è¦½é é¢çš„ C å€ç”Ÿæ´»å»ºè­°
         * @param {object} result - åˆ†æçµæœè³‡æ–™
         */
        function updateLifestyleAdvice(result) {
            const badgesContainer = document.getElementById('lifestyle-badges');
            const nutritionList = document.getElementById('nutrition-list');
            const sleepDetail = document.getElementById('sleep-detail');
            const exerciseDetail = document.getElementById('exercise-detail');

            // å–å¾— lifestyle_advice
            const advice = result?.lifestyle_advice;
            if (!advice) {
                console.warn('No lifestyle advice data');
                return;
            }

            // 1. æ›´æ–°ç¸½è¦½é é¢å¾½ç« 
            if (badgesContainer) {
                badgesContainer.innerHTML = `
                    <div class="advice-badge">
                        <span class="advice-icon">ğŸ¥—</span>
                        <span class="advice-text">ç‡Ÿé¤Šï¼š${advice.nutrition?.summary || 'å‡è¡¡é£²é£Ÿ'}</span>
                    </div>
                    <div class="advice-badge">
                        <span class="advice-icon">ğŸ˜´</span>
                        <span class="advice-text">ä½œæ¯ï¼š${advice.sleep?.summary || 'å……è¶³ç¡çœ '}</span>
                    </div>
                    <div class="advice-badge">
                        <span class="advice-icon">ğŸƒ</span>
                        <span class="advice-text">é‹å‹•ï¼š${advice.exercise?.summary || 'è¦å¾‹é‹å‹•'}</span>
                    </div>
                `;
            }

            // 2. æ›´æ–°è©³æƒ…é é¢å…§å®¹
            if (nutritionList && advice.nutrition?.items) {
                nutritionList.innerHTML = advice.nutrition.items.map(item => `<li>${item}</li>`).join('');
            }
            if (sleepDetail && advice.sleep?.detail) {
                sleepDetail.textContent = advice.sleep.detail;
            }
            if (exerciseDetail && advice.exercise?.detail) {
                exerciseDetail.textContent = advice.exercise.detail;
            }

            console.log('âœ… Lifestyle advice updated (Overview \u0026 Details)');
        }

        // ========================================
        // ç¸½è¦½é é¢æ‘˜è¦æ›´æ–°
        // ========================================

        /**
         * æ™ºèƒ½æå–æ‘˜è¦ï¼ˆå–ç¬¬ä¸€å¥è©±ï¼‰
         * @param {string} text - å®Œæ•´æ–‡å­—
         * @param {number} maxLength - æœ€å¤§é•·åº¦
         * @returns {string} æ‘˜è¦æ–‡å­—
         */
        function extractSummary(text, maxLength = 30) {
            if (!text) return '';

            // ç§»é™¤å‰å¾Œç©ºç™½
            text = text.trim();

            // å˜—è©¦æ‰¾åˆ°ç¬¬ä¸€å€‹å¥è™Ÿã€é©šå˜†è™Ÿæˆ–å•è™Ÿ
            const sentenceEnd = text.search(/[ã€‚ï¼ï¼Ÿ.!?]/);
            if (sentenceEnd !== -1) {
                text = text.substring(0, sentenceEnd);
            }

            // å¦‚æœé‚„æ˜¯å¤ªé•·ï¼Œæˆªæ–·ä¸¦åŠ ä¸Šçœç•¥è™Ÿ
            if (text.length > maxLength) {
                text = text.substring(0, maxLength) + '...';
            }

            return text;
        }

        /**
         * æ›´æ–°ç¸½è¦½é é¢çš„ A å€æ‘˜è¦
         * @param {object} result - åˆ†æçµæœè³‡æ–™
         */
        function updateOverviewSummary(result) {
            const positiveSummaryEl = document.getElementById('overview-positive-summary');
            const attentionSummaryEl = document.getElementById('overview-attention-summary');

            if (!result) {
                console.warn('No result data for overview summary');
                return;
            }

            // æ–¹æ¡ˆ 1: å¾ ai_diagnosis å–å¾—è³‡æ–™ï¼ˆå„ªå…ˆï¼‰
            if (result.ai_diagnosis) {
                const { positive_feedback, problem_analysis } = result.ai_diagnosis;

                if (positiveSummaryEl && positive_feedback) {
                    positiveSummaryEl.textContent = extractSummary(positive_feedback, 30);
                }

                if (attentionSummaryEl && problem_analysis) {
                    attentionSummaryEl.textContent = extractSummary(problem_analysis, 25);
                }
            }
            // æ–¹æ¡ˆ 2: å¾ a_summary å’Œ a_issue å–å¾—è³‡æ–™ï¼ˆå‚™ç”¨ï¼‰
            else if (result.a_summary || result.a_issue) {
                if (positiveSummaryEl && result.a_summary) {
                    // æå– a_summary çš„å‰åŠéƒ¨åˆ†ï¼ˆé€šå¸¸æ˜¯æ­£é¢è©•åƒ¹ï¼‰
                    const parts = result.a_summary.split(/[ï¼›;ä½†]/);
                    const positivePart = parts[0] || result.a_summary;
                    positiveSummaryEl.textContent = extractSummary(positivePart, 30);
                }

                if (attentionSummaryEl) {
                    // å„ªå…ˆä½¿ç”¨ a_issue_detailï¼Œå¦å‰‡ä½¿ç”¨ a_issue
                    const issue = result.a_issue_detail || result.a_issue || 'è«‹ä¿æŒè‰¯å¥½ç¿’æ…£';
                    attentionSummaryEl.textContent = extractSummary(issue, 25);
                }
            }
            // æ–¹æ¡ˆ 3: ä½¿ç”¨é è¨­æ–‡å­—
            else {
                console.warn('Using default summary text');
                if (positiveSummaryEl) {
                    positiveSummaryEl.textContent = 'æ°£è‰²æ•´é«”ç©©å®šï¼Œè†šè‰²å‡å‹»åº¦è‰¯å¥½';
                }
                if (attentionSummaryEl) {
                    attentionSummaryEl.textContent = 'çœ¼å‘¨å€åŸŸç•¥é¡¯ç–²æ…‹';
                }
            }

            console.log('âœ… Overview summary updated');
        }

        // å¾ localStorage è¼‰å…¥çµæœ
        function loadResult() {
            const keys = ["result", "ai_result", "analysis_result", "payload"];
            for (const k of keys) {
                const raw = localStorage.getItem(k);
                if (!raw) continue;
                try {
                    return JSON.parse(raw);
                } catch (e) {
                    console.error('Parse error:', e);
                }
            }
            // å¦‚æœæ²’æœ‰è³‡æ–™,è¿”å›æ¸¬è©¦æ•¸æ“š
            return {
                overall: 78,
                metrics: {
                    glow: 72,
                    complexion: 80,
                    blemish: 64,
                    oilBalance: 70,
                    evenness: 75
                }
            };
        }

        // ========================================
        // A å€ï¼šæ¸²æŸ“ AI è¨ºæ–·èˆ‡æŒ‰æ‘©æ¨è–¦
        // ========================================

        /**
         * æ¸²æŸ“ AI è¨ºæ–·å…§å®¹
         */
        function renderAIDiagnosis(diagnosis) {
            const positiveFeedback = document.getElementById('ai-positive-feedback');
            const problemAnalysis = document.getElementById('ai-problem-analysis');

            if (positiveFeedback && diagnosis && diagnosis.positive_feedback) {
                positiveFeedback.textContent = diagnosis.positive_feedback;
            }

            if (problemAnalysis && diagnosis && diagnosis.problem_analysis) {
                problemAnalysis.textContent = diagnosis.problem_analysis;
            }
        }

        /**
         * æ¸²æŸ“æŒ‰æ‘©æ¨è–¦
         */
        function renderMassageRecommendations(massages) {
            const massageList = document.getElementById('massage-list');
            if (!massageList) return;

            // å¦‚æœæ²’æœ‰è³‡æ–™ï¼Œä½¿ç”¨å‡è³‡æ–™
            if (!massages || massages.length === 0) {
                massages = [
                    {
                        name: "çœ¼å‘¨èˆ’ç·©æŒ‰æ‘©",
                        gif_url: "https://via.placeholder.com/300x200/EDF2F7/718096?text=çœ¼å‘¨æŒ‰æ‘©",
                        duration: "2 åˆ†é˜",
                        steps: "1. ç”¨æŒ‡è…¹è¼•æŒ‰å¤ªé™½ç©´ 3 ç§’\n2. æ²¿çœ¼çœ¶ç”±å…§å‘å¤–ç•«åœˆ 5 æ¬¡\n3. è¼•å£“çœ¼é ­ç©´ä½ 3 ç§’",
                        benefits: "ä¿ƒé€²çœ¼å‘¨è¡€æ¶²å¾ªç’°ï¼Œæ¸›ç·©ç–²å‹æ„Ÿï¼Œæå‡çœ¼éƒ¨æ˜äº®åº¦"
                    },
                    {
                        name: "è‡‰éƒ¨ææ‹‰æŒ‰æ‘©",
                        gif_url: "https://via.placeholder.com/300x200/EDF2F7/718096?text=è‡‰éƒ¨ææ‹‰",
                        duration: "3 åˆ†é˜",
                        steps: "1. å¾ä¸‹å·´å¾€è€³éš›ææ‹‰ 10 æ¬¡\n2. é¡é ­ç”±å…§å‘å¤–æ¨ 10 æ¬¡\n3. é¼»ç¿¼å…©å´è¼•æŒ‰ 5 æ¬¡",
                        benefits: "æå‡è‡‰éƒ¨è¼ªå»“ï¼Œä¿ƒé€²æ·‹å·´æ’æ¯’ï¼Œæ”¹å–„æ•´é«”æ°£è‰²"
                    }
                ];
            }

            massageList.innerHTML = massages.map(massage => `
                <div class="massage-item">
                    <div class="massage-gif-container">
                        <img src="${massage.gif_url}" 
                             alt="${massage.name}" 
                             class="massage-gif-img"
                             onerror="this.parentElement.innerHTML='<div style=\\'padding:20px;text-align:center;color:var(--muted)\\'>GIF è¼‰å…¥ä¸­...</div>'">
                    </div>
                    <div class="massage-info">
                        <div class="massage-name">${massage.name}</div>
                        <div class="massage-duration">â±ï¸ ${massage.duration}</div>
                        <div class="massage-steps">
                            <strong>å‹•ä½œèªªæ˜ï¼š</strong>
                            <p>${massage.steps}</p>
                        </div>
                        <div class="massage-benefits">
                            <strong>æ•ˆæœï¼š</strong>
                            <p>${massage.benefits}</p>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        /**
         * è¼‰å…¥ A å€è³‡æ–™
         */
        function loadSectionAData() {
            const result = loadResult();

            // æ¸²æŸ“ AI è¨ºæ–·ï¼ˆå¦‚æœæœ‰è³‡æ–™ï¼‰
            if (result && result.ai_diagnosis) {
                renderAIDiagnosis(result.ai_diagnosis);
            }

            // æ¸²æŸ“æŒ‰æ‘©æ¨è–¦ï¼ˆå¦‚æœæœ‰è³‡æ–™ï¼Œå¦å‰‡ä½¿ç”¨å‡è³‡æ–™ï¼‰
            if (result && result.massage_recommendations) {
                renderMassageRecommendations(result.massage_recommendations);
            } else {
                renderMassageRecommendations(); // ä½¿ç”¨å‡è³‡æ–™
            }
        }

        // é é¢è¼‰å…¥æ™‚åŸ·è¡Œ
        window.addEventListener('DOMContentLoaded', () => {
            loadData();
            loadSectionAData(); // è¼‰å…¥ A å€è³‡æ–™
        });

        window.showDetail = showDetail;
        window.backToOverview = backToOverview;
        window.saveToLine = saveToLine;
    </script>
    <!-- è¡Œå‹•æ¨è–¦ç³»çµ± -->
    <script src="./js/action-recommendations.js"></script>
    <script>
        async function initActionRecommendations() {
            try {
                await actionRecommendationManager.init();
                const result = loadResult ? loadResult() : null;
                const llmDetection = result?.llm_detection || {
                    summary: "æ‚¨çš„è‚Œè†šæ•´é«”ç‹€æ³è‰¯å¥½ï¼Œä½†åœ¨ä»¥ä¸‹å¹¾å€‹æ–¹é¢æœ‰æ”¹å–„ç©ºé–“ã€‚",
                    detectedIssues: [1, 4, 5, 10]
                };
                if (llmDetection.detectedIssues && llmDetection.detectedIssues.length > 0) {
                    actionRecommendationManager.displayRecommendations(
                        llmDetection.detectedIssues,
                        '#action-recommendations-container',
                        llmDetection.summary
                    );
                }
            } catch (error) {
                console.error('âŒ éŒ¯èª¤:', error);
            }
        }
        window.addEventListener('DOMContentLoaded', initActionRecommendations);
    </script>
</body>

</html>